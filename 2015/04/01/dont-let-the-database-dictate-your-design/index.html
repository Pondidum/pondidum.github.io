<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Don't Let The Database Dictate Your Design | Andy Dote</title>
<meta name=keywords content="design,postgres,sql,architecture"><meta name=description content="I have been thinking recently about how the database can influence our design decisions, and perhaps makes them harder than they need to be in some cases. An example of this is the design of a system which stores data about people, specifically for this, their email addresses. A cut down version of the structure is this:
table people id serial primary key firstname varchar(50) lastname varchar(50) table emails id serial primary key person_id int => people."><meta name=author content><link rel=canonical href=https://andydote.co.uk/2015/04/01/dont-let-the-database-dictate-your-design/><link crossorigin=anonymous href=/assets/css/stylesheet.min.d3aaf8cdcec9a6487824ab95cadf08232ec362e7ba510c6b742973d16ef5b72e.css integrity="sha256-06r4zc7Jpkh4JKuVyt8IIy7DYue6UQxrdClz0W71ty4=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/mermaid.min.c6a36963ab47314b3d95fe85a9385337e1ef8eb1c2194eecb86f178d492ab666.js integrity="sha256-xqNpY6tHMUs9lf6FqThTN+HvjrHCGU7suG8XjUkqtmY="></script><script defer crossorigin=anonymous src=/js/tabs.min.2d019e9ee3574770ad4ecfd4f5f794739892195cb82a4e6383252b9074ab520c.js integrity="sha256-LQGenuNXR3CtTs/U9feUc5iSGVy4Kk5jgyUrkHSrUgw="></script><link rel=icon href=https://andydote.co.uk/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://andydote.co.uk/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://andydote.co.uk/favicon-32x32.png><link rel=apple-touch-icon href=https://andydote.co.uk/apple-touch-icon.png><link rel=mask-icon href=https://andydote.co.uk/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Don't Let The Database Dictate Your Design"><meta property="og:description" content="I have been thinking recently about how the database can influence our design decisions, and perhaps makes them harder than they need to be in some cases. An example of this is the design of a system which stores data about people, specifically for this, their email addresses. A cut down version of the structure is this:
table people id serial primary key firstname varchar(50) lastname varchar(50) table emails id serial primary key person_id int => people."><meta property="og:type" content="article"><meta property="og:url" content="https://andydote.co.uk/2015/04/01/dont-let-the-database-dictate-your-design/"><meta property="article:section" content="post"><meta property="article:published_time" content="2015-04-01T00:00:00+00:00"><meta property="article:modified_time" content="2015-04-01T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Don't Let The Database Dictate Your Design"><meta name=twitter:description content="I have been thinking recently about how the database can influence our design decisions, and perhaps makes them harder than they need to be in some cases. An example of this is the design of a system which stores data about people, specifically for this, their email addresses. A cut down version of the structure is this:
table people id serial primary key firstname varchar(50) lastname varchar(50) table emails id serial primary key person_id int => people."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://andydote.co.uk/post/"},{"@type":"ListItem","position":3,"name":"Don't Let The Database Dictate Your Design","item":"https://andydote.co.uk/2015/04/01/dont-let-the-database-dictate-your-design/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Don't Let The Database Dictate Your Design","name":"Don\u0027t Let The Database Dictate Your Design","description":"I have been thinking recently about how the database can influence our design decisions, and perhaps makes them harder than they need to be in some cases. An example of this is the design of a system which stores data about people, specifically for this, their email addresses. A cut down version of the structure is this:\ntable people id serial primary key firstname varchar(50) lastname varchar(50) table emails id serial primary key person_id int =\u0026gt; people.","keywords":["design","postgres","sql","architecture"],"articleBody":"I have been thinking recently about how the database can influence our design decisions, and perhaps makes them harder than they need to be in some cases. An example of this is the design of a system which stores data about people, specifically for this, their email addresses. A cut down version of the structure is this:\ntable people id serial primary key firstname varchar(50) lastname varchar(50) table emails id serial primary key person_id int =\u003e people.id address varchar(100) type int Which is represented in code like so:\npublic class Person { public int ID { get; private set; } public string FirstName { get; set; } public string LastName { get; set; } public List Emails { get; private set; } public Person() { Emails = new List(); } } public class Email { public int ID { get; private set; } public int PersonID { get; set; } public string Address { get; set; } public EmailTypes Type { get; set; } } While this works, it is heavily influenced by the storage technology. Email addresses by definition are unique already, so why do we need a primary key column? They are also associated with exactly one person, so the person_id column is only here to facilitate that. Why not get rid of the emails table completely, and store the person’s email addresses in a single column in the person table? This could be done with a simple csv, but it would be more fore-thinking to use json, so we can associate a little more data with each email address.\nSo before we get on to putting data in one column, what reasons we have to keep emails as a separate table?\nSo they can be queried by ID. So we can put a constraint across [person_id, address] and [person_id, type]. So all emails of a given type can be found. So a person can be looked up by email. So we can attach rules to them. The first three can be answered easily: you never query for an email address by its primary key, only by the address itself. The constraints are really just a safety net, and a nice to have at best - the collection which manages emails is well tested, implements all business rules properly, and everything which deals with emails uses it. Getting all emails of a particular type is a legitamate requirement, but can be gotten around in several ways: selecting the entire email column in a sql query, and doing additional filtering client side for the specific email types, or if you are using a database which supports json querying (such as postgres), using that to narrow the results down.\nThe final point is the most interesting, as it could be resolved with a few different designs. The current design has one additional table:\ntable rules id serial primary key person_id int =\u003e people.id target_type int --e.g 1=email, 2=phone, 3=address etc target_id int active bool And the Person object has a method like this:\npublic bool HasRuleInForce(Entity target) { return Rules .Where(rule =\u003e rule.TargetType == target.Type) .Where(rule =\u003e rule.TargetID == target.ID) .Where(rule =\u003e rule.Active) .Any(); } While this works, the design has a few problems:\nThere is no foreign keying of rules.target_id available So you have to remember to delete rules when deleting any entity You have to remember if an entity is valid for rules to be attached to If normalisation was your argument for an emails table, explain this table relationship… There are two solutions to this problem:\nThe first is to change the rules table to just have a target column, and put the unique data in there e.g. a rule for an email would have the email address in the target column, a rule for a phone number would have the actual phone number in the target column. While this works, it doesn’t really improve the design of the system; we still have the existing joins and “remember to also” problems of before.\nThe second solution is to remove the rules table entirely and implement rules as small collections on each target entity, and make the person.Rules property a readonly aggregate. This has a few advantages: each entity explicitly has a rule collection if applicable, and we no longer need to remember to check another collection for updates/deletes.\nThe implementation of a .Rules property on each entity is trivial - just a standard list property:\npublic class Email { public int ID { get; private set; } public int PersonID { get; set; } public string Address { get; set; } public EmailTypes Type { get; set; } public List Rules { get; set; } } As we don’t wish to repeat the logic on each collection of rules, we can add an extension method for checking if rules are in force:\npublic static class RulesExtensions { public static bool HasRuleInForce(this IEnumerable self) { return self.Any(rule =\u003e rule.Active); } } And finally on the Person object itself, we can make a simple aggregate property for all child entity’s rules:\npublic IEnumerable Rules { get { var all = new[] { Emails.SelectMany(e =\u003e e.Rules), Phones.SelectMany(p =\u003e p.Rules), }; return all.SelectMany(r =\u003e r); } } Personally I prefer the 2nd form of this, as it makes domain modelling a lot more straight forward - however like all things, you should consider all your requirements carefully - and don’t let the database (sql or nosql variety) dictate your model.\n","wordCount":"909","inLanguage":"en","datePublished":"2015-04-01T00:00:00Z","dateModified":"2015-04-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://andydote.co.uk/2015/04/01/dont-let-the-database-dictate-your-design/"},"publisher":{"@type":"Organization","name":"Andy Dote","logo":{"@type":"ImageObject","url":"https://andydote.co.uk/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://andydote.co.uk accesskey=h title="Andy Dote (Alt + H)">Andy Dote</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://andydote.co.uk/archive title=Archive><span>Archive</span></a></li><li><a href=https://andydote.co.uk/talks title=Talks><span>Talks</span></a></li><li><a href=https://andydote.co.uk/notes title=Notes><span>Notes</span></a></li><li><a href=https://andydote.co.uk/tags title=Tags><span>Tags</span></a></li><li><a href=https://andydote.co.uk/contact title=Contact><span>Contact</span></a></li><li><a href=https://andydote.co.uk/rss.xml title=RSS><span>RSS</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Don't Let The Database Dictate Your Design</h1><div class=post-meta>&lt;span title='2015-04-01 00:00:00 +0000 UTC'>April 1, 2015&lt;/span>&amp;nbsp;·&amp;nbsp;5 min</div></header><div class=post-content><p>I have been thinking recently about how the database can influence our design decisions, and perhaps makes them harder than they need to be in some cases. An example of this is the design of a system which stores data about people, specifically for this, their email addresses. A cut down version of the structure is this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>table</span> people
</span></span><span style=display:flex><span>id serial <span style=color:#66d9ef>primary</span> <span style=color:#66d9ef>key</span>
</span></span><span style=display:flex><span>firstname varchar(<span style=color:#ae81ff>50</span>)
</span></span><span style=display:flex><span>lastname varchar(<span style=color:#ae81ff>50</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>table</span> emails
</span></span><span style=display:flex><span>id serial <span style=color:#66d9ef>primary</span> <span style=color:#66d9ef>key</span>
</span></span><span style=display:flex><span>person_id int <span style=color:#f92672>=&gt;</span> people.id
</span></span><span style=display:flex><span>address varchar(<span style=color:#ae81ff>100</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> int
</span></span></code></pre></div><p>Which is represented in code like so:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Person</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> ID { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>string</span> FirstName { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>string</span> LastName { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> List&lt;Email&gt; Emails { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> Person()
</span></span><span style=display:flex><span>	{
</span></span><span style=display:flex><span>		Emails = <span style=color:#66d9ef>new</span> List&lt;Email&gt;();
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Email</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> ID { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> PersonID { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>string</span> Address { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> EmailTypes Type { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>While this works, it is heavily influenced by the storage technology. Email addresses by definition are unique already, so why do we need a primary key column? They are also associated with exactly one person, so the <code>person_id</code> column is only here to facilitate that. Why not get rid of the emails table completely, and store the person&rsquo;s email addresses in a single column in the person table? This could be done with a simple csv, but it would be more fore-thinking to use json, so we can associate a little more data with each email address.</p><p>So before we get on to putting data in one column, what reasons we have to keep emails as a separate table?</p><ul><li>So they can be queried by ID.</li><li>So we can put a constraint across <code>[person_id, address]</code> and <code>[person_id, type]</code>.</li><li>So all emails of a given type can be found.</li><li>So a person can be looked up by email.</li><li>So we can attach rules to them.</li></ul><p>The first three can be answered easily: you never query for an email address by its primary key, only by the address itself. The constraints are really just a safety net, and a nice to have at best - the collection which manages emails is well tested, implements all business rules properly, and everything which deals with emails uses it. Getting all emails of a particular type is a legitamate requirement, but can be gotten around in several ways: selecting the entire email column in a sql query, and doing additional filtering client side for the specific email types, or if you are using a database which supports json querying (such as postgres), using that to narrow the results down.</p><p>The final point is the most interesting, as it could be resolved with a few different designs. The current design has one additional table:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>table</span> rules
</span></span><span style=display:flex><span>id serial <span style=color:#66d9ef>primary</span> <span style=color:#66d9ef>key</span>
</span></span><span style=display:flex><span>person_id int <span style=color:#f92672>=&gt;</span> people.id
</span></span><span style=display:flex><span>target_type int <span style=color:#75715e>--e.g 1=email, 2=phone, 3=address etc
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>target_id int
</span></span><span style=display:flex><span>active bool
</span></span></code></pre></div><p>And the <code>Person</code> object has a method like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>bool</span> HasRuleInForce(Entity target)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> Rules
</span></span><span style=display:flex><span>		.Where(rule =&gt; rule.TargetType == target.Type)
</span></span><span style=display:flex><span>		.Where(rule =&gt; rule.TargetID == target.ID)
</span></span><span style=display:flex><span>		.Where(rule =&gt; rule.Active)
</span></span><span style=display:flex><span>		.Any();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>While this works, the design has a few problems:</p><ul><li>There is no foreign keying of <code>rules.target_id</code> available</li><li>So you have to remember to delete rules when deleting any entity</li><li>You have to remember if an entity is valid for rules to be attached to</li><li>If normalisation was your argument for an <code>emails</code> table, explain this table relationship&mldr;</li></ul><p>There are two solutions to this problem:</p><p>The first is to change the rules table to just have a <code>target</code> column, and put the unique data in there e.g. a rule for an email would have the email address in the <code>target</code> column, a rule for a phone number would have the actual phone number in the <code>target</code> column. While this works, it doesn&rsquo;t really improve the design of the system; we still have the existing joins and &ldquo;remember to also&rdquo; problems of before.</p><p>The second solution is to remove the <code>rules</code> table entirely and implement rules as small collections on each target entity, and make the <code>person.Rules</code> property a readonly aggregate. This has a few advantages: each entity explicitly has a rule collection if applicable, and we no longer need to remember to check another collection for updates/deletes.</p><p>The implementation of a <code>.Rules</code> property on each entity is trivial - just a standard list property:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Email</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> ID { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> PersonID { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>string</span> Address { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> EmailTypes Type { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> List&lt;Rule&gt; Rules { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>As we don&rsquo;t wish to repeat the logic on each collection of rules, we can add an extension method for checking if rules are in force:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RulesExtensions</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>bool</span> HasRuleInForce(<span style=color:#66d9ef>this</span> IEnumerable&lt;Rule&gt; self)
</span></span><span style=display:flex><span>	{
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> self.Any(rule =&gt; rule.Active);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>And finally on the <code>Person</code> object itself, we can make a simple aggregate property for all child entity&rsquo;s rules:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>public</span> IEnumerable&lt;Rule&gt; Rules
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>get</span>
</span></span><span style=display:flex><span>	{
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>var</span> all = <span style=color:#66d9ef>new</span>[]
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			Emails.SelectMany(e =&gt; e.Rules),
</span></span><span style=display:flex><span>			Phones.SelectMany(p =&gt; p.Rules),
</span></span><span style=display:flex><span>		};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> all.SelectMany(r =&gt; r);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Personally I prefer the 2nd form of this, as it makes domain modelling a lot more straight forward - however like all things, you should consider all your requirements carefully - and don&rsquo;t let the database (sql or nosql variety) dictate your model.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://andydote.co.uk/tags/design/>design</a></li><li><a href=https://andydote.co.uk/tags/postgres/>postgres</a></li><li><a href=https://andydote.co.uk/tags/sql/>sql</a></li><li><a href=https://andydote.co.uk/tags/architecture/>architecture</a></li></ul><nav class=paginav><a class=prev href=https://andydote.co.uk/2015/08/30/single-project-service-and-console/><span class=title>« Prev Page</span><br><span>A single project Windows Service and Console</span>
</a><a class=next href=https://andydote.co.uk/2015/03/28/problems-with-and-solutions-to-repositories/><span class=title>Next Page »</span><br><span>The problems with and solutions to Repositories</span></a></nav></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>
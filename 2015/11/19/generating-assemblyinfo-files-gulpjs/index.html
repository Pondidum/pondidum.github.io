<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Generating AssemblyInfo files with Gulp | Andy Dote</title><meta name=keywords content="c#,gulp"><meta name=description content="When changing a project&rsquo;s build script over to Gulpjs, I ran into a problem with one step - creating an AssemblyInfo.cs file.
My projects have their version number in the package.json file, and I read that at compile time, pull in some information from the build server, and write that to an AssemblyVersion.cs file. This file is not tracked by git, and I don&rsquo;t want it showing up as a modification if you run the build script locally."><meta name=author content><link rel=canonical href=https://andydote.co.uk/2015/11/19/generating-assemblyinfo-files-gulpjs/><link crossorigin=anonymous href=/assets/css/stylesheet.min.2b33c247bf6959372dd097f2cfdcd9f4d5019027cd9b1e28ae3d14c17c37ac00.css integrity="sha256-KzPCR79pWTct0Jfyz9zZ9NUBkCfNmx4orj0UwXw3rAA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/mermaid.min.725f44bd345b0a2a4043ca952b0863edd789e913cf0813a12bbdfe986fe87079.js integrity="sha256-cl9EvTRbCipAQ8qVKwhj7deJ6RPPCBOhK73+mG/ocHk="></script>
<script defer crossorigin=anonymous src=/js/tabs.min.2d019e9ee3574770ad4ecfd4f5f794739892195cb82a4e6383252b9074ab520c.js integrity="sha256-LQGenuNXR3CtTs/U9feUc5iSGVy4Kk5jgyUrkHSrUgw="></script>
<link rel=icon href=https://andydote.co.uk/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://andydote.co.uk/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://andydote.co.uk/favicon-32x32.png><link rel=apple-touch-icon href=https://andydote.co.uk/apple-touch-icon.png><link rel=mask-icon href=https://andydote.co.uk/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Generating AssemblyInfo files with Gulp"><meta property="og:description" content="When changing a project&rsquo;s build script over to Gulpjs, I ran into a problem with one step - creating an AssemblyInfo.cs file.
My projects have their version number in the package.json file, and I read that at compile time, pull in some information from the build server, and write that to an AssemblyVersion.cs file. This file is not tracked by git, and I don&rsquo;t want it showing up as a modification if you run the build script locally."><meta property="og:type" content="article"><meta property="og:url" content="https://andydote.co.uk/2015/11/19/generating-assemblyinfo-files-gulpjs/"><meta property="article:section" content="post"><meta property="article:published_time" content="2015-11-19T00:00:00+00:00"><meta property="article:modified_time" content="2015-11-19T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Generating AssemblyInfo files with Gulp"><meta name=twitter:description content="When changing a project&rsquo;s build script over to Gulpjs, I ran into a problem with one step - creating an AssemblyInfo.cs file.
My projects have their version number in the package.json file, and I read that at compile time, pull in some information from the build server, and write that to an AssemblyVersion.cs file. This file is not tracked by git, and I don&rsquo;t want it showing up as a modification if you run the build script locally."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://andydote.co.uk/post/"},{"@type":"ListItem","position":3,"name":"Generating AssemblyInfo files with Gulp","item":"https://andydote.co.uk/2015/11/19/generating-assemblyinfo-files-gulpjs/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Generating AssemblyInfo files with Gulp","name":"Generating AssemblyInfo files with Gulp","description":"When changing a project\u0026rsquo;s build script over to Gulpjs, I ran into a problem with one step - creating an AssemblyInfo.cs file.\nMy projects have their version number in the package.json file, and I read that at compile time, pull in some information from the build server, and write that to an AssemblyVersion.cs file. This file is not tracked by git, and I don\u0026rsquo;t want it showing up as a modification if you run the build script locally.","keywords":["c#","gulp"],"articleBody":"When changing a project’s build script over to Gulpjs, I ran into a problem with one step - creating an AssemblyInfo.cs file.\nMy projects have their version number in the package.json file, and I read that at compile time, pull in some information from the build server, and write that to an AssemblyVersion.cs file. This file is not tracked by git, and I don’t want it showing up as a modification if you run the build script locally.\nThe problem is that the gulp-dotnet-assembly-info package doesn’t support generation of files, only updating. To get around this I used the gulp-rename package to read a template file, and generate the non-tracked AssemblyVersion.cs file.\nSteps First, create an AssemblyVersion.base file, and save it somewhere in your repository. I usually put it next to the gulpfile, or in the projects Properties directory, depending on if the project has multiple assemblies or not. This file can be added and tracked by git - it won’t get changed.\nusing System.Reflection; using System.Runtime.CompilerServices; using System.Runtime.InteropServices; [assembly: AssemblyVersion(\"0.0.0\")] [assembly: AssemblyFileVersion(\"0.0.0\")] [assembly: AssemblyDescription(\"Build: 0, Commit Sha: 0\")] Next install the two gulp modules, and import into your gulpfile:\nnpm install gulp-rename --save npm install gulp-dotnet-assembly-info --save var rename = require('gulp-rename'); var assemblyInfo = require('gulp-dotnet-assembly-info'); In the gulp file, read the package.json file and the environment variables. I do this once at the begining of my gulpfile and use the config all over the place.\nvar project = JSON.parse(fs.readFileSync(\"./package.json\")); var config = { name: project.name, version: project.version, commit: process.env.APPVEYOR_REPO_COMMIT || \"0\", buildNumber: process.env.APPVEYOR_BUILD_VERSION || \"0\", } Then add a task to create a new AssemblyVersion.cs file. Change the src parameter to match where you saved the AssemblyVersion.base file.\ngulp.task('version', function() { return gulp .src(config.name + '/Properties/AssemblyVersion.base') .pipe(rename(\"AssemblyVersion.cs\")) .pipe(assemblyInfo({ version: config.version, fileVersion: config.version, description: \"Build: \" + config.buildNumber + \", Sha: \" + config.commit })) .pipe(gulp.dest('./' + config.name + '/Properties')); }); Don’t forget to reference the AssemblyVersion.cs file in your csproj!\nYou can see a full gulpfile with this in here: Magistrate gulpfile.\n","wordCount":"333","inLanguage":"en","datePublished":"2015-11-19T00:00:00Z","dateModified":"2015-11-19T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://andydote.co.uk/2015/11/19/generating-assemblyinfo-files-gulpjs/"},"publisher":{"@type":"Organization","name":"Andy Dote","logo":{"@type":"ImageObject","url":"https://andydote.co.uk/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://andydote.co.uk accesskey=h title="Andy Dote (Alt + H)">Andy Dote</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://andydote.co.uk/archive title=Archive><span>Archive</span></a></li><li><a href=https://andydote.co.uk/talks title=Talks><span>Talks</span></a></li><li><a href=https://andydote.co.uk/notes title=Notes><span>Notes</span></a></li><li><a href=https://andydote.co.uk/tags title=Tags><span>Tags</span></a></li><li><a href=https://andydote.co.uk/contact title=Contact><span>Contact</span></a></li><li><a href=https://andydote.co.uk/rss.xml title=RSS><span>RSS</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Generating AssemblyInfo files with Gulp</h1><div class=post-meta><span title='2015-11-19 00:00:00 +0000 UTC'>November 19, 2015</span>&nbsp;·&nbsp;2 min</div></header><div class=post-content><p>When changing a project&rsquo;s build script over to <a href=http://gulpjs.com/>Gulpjs</a>, I ran into a problem with one step - creating an <code>AssemblyInfo.cs</code> file.</p><p>My projects have their version number in the <code>package.json</code> file, and I read that at compile time, pull in some information from the build server, and write that to an <code>AssemblyVersion.cs</code> file. This file is not tracked by git, and I don&rsquo;t want it showing up as a modification if you run the build script locally.</p><p>The problem is that the <a href=https://www.npmjs.com/package/gulp-dotnet-assembly-info>gulp-dotnet-assembly-info</a> package doesn&rsquo;t support generation of files, only updating. To get around this I used the <a href=https://www.npmjs.com/package/gulp-rename>gulp-rename</a> package to read a template file, and generate the non-tracked <code>AssemblyVersion.cs</code> file.</p><h2 id=steps>Steps<a hidden class=anchor aria-hidden=true href=#steps>#</a></h2><p>First, create an <code>AssemblyVersion.base</code> file, and save it somewhere in your repository. I usually put it next to the <code>gulpfile</code>, or in the projects <code>Properties</code> directory, depending on if the project has multiple assemblies or not. This file can be added and tracked by git - it won&rsquo;t get changed.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>using</span> System.Reflection;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> System.Runtime.CompilerServices;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> System.Runtime.InteropServices;
</span></span><span style=display:flex><span><span style=color:#a6e22e>
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>[assembly: AssemblyVersion(&#34;0.0.0&#34;)]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>[assembly: AssemblyFileVersion(&#34;0.0.0&#34;)]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>[assembly: AssemblyDescription(&#34;Build: 0, Commit Sha: 0&#34;)]</span>
</span></span></code></pre></div><p>Next install the two gulp modules, and import into your <code>gulpfile</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm install gulp-rename --save
</span></span><span style=display:flex><span>npm install gulp-dotnet-assembly-info --save
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>rename</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;gulp-rename&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>assemblyInfo</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;gulp-dotnet-assembly-info&#39;</span>);
</span></span></code></pre></div><p>In the gulp file, read the <code>package.json</code> file and the environment variables. I do this once at the begining of my <code>gulpfile</code> and use the config all over the place.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>project</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>readFileSync</span>(<span style=color:#e6db74>&#34;./package.json&#34;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>config</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>project</span>.<span style=color:#a6e22e>name</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>version</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>project</span>.<span style=color:#a6e22e>version</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>commit</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>APPVEYOR_REPO_COMMIT</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;0&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>buildNumber</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>APPVEYOR_BUILD_VERSION</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;0&#34;</span>,
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Then add a task to create a new <code>AssemblyVersion.cs</code> file. Change the <code>src</code> parameter to match where you saved the <code>AssemblyVersion.base</code> file.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>gulp</span>.<span style=color:#a6e22e>task</span>(<span style=color:#e6db74>&#39;version&#39;</span>, <span style=color:#66d9ef>function</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>gulp</span>
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>src</span>(<span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;/Properties/AssemblyVersion.base&#39;</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>pipe</span>(<span style=color:#a6e22e>rename</span>(<span style=color:#e6db74>&#34;AssemblyVersion.cs&#34;</span>))
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>pipe</span>(<span style=color:#a6e22e>assemblyInfo</span>({
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>version</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>version</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>fileVersion</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>version</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>description</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Build: &#34;</span> <span style=color:#f92672>+</span>  <span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>buildNumber</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;, Sha: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>commit</span>
</span></span><span style=display:flex><span>    }))
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>pipe</span>(<span style=color:#a6e22e>gulp</span>.<span style=color:#a6e22e>dest</span>(<span style=color:#e6db74>&#39;./&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;/Properties&#39;</span>));
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>Don&rsquo;t forget to reference the <code>AssemblyVersion.cs</code> file in your csproj!</p><p>You can see a full <code>gulpfile</code> with this in here: <a href=https://github.com/Pondidum/Magistrate/blob/master/gulpfile.js>Magistrate gulpfile</a>.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://andydote.co.uk/tags/c#/>c#</a></li><li><a href=https://andydote.co.uk/tags/gulp/>gulp</a></li></ul><nav class=paginav><a class=prev href=https://andydote.co.uk/2016/03/18/rabbitmq-xunit/><span class=title>« Prev Page</span><br><span>RabbitMQ integration tests in XUnit</span></a>
<a class=next href=https://andydote.co.uk/2015/09/21/webapi-post-plaintext/><span class=title>Next Page »</span><br><span>Posting PlainText to Asp WebApi</span></a></nav></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>
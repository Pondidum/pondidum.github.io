<!doctype html><html lang=en dir=auto><head><meta name=generator content="Hugo 0.118.2"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Andy Dote</title><meta name=description content><meta name=author content><link rel=canonical href=https://andydote.co.uk/><link crossorigin=anonymous href=/assets/css/stylesheet.min.d3aaf8cdcec9a6487824ab95cadf08232ec362e7ba510c6b742973d16ef5b72e.css integrity="sha256-06r4zc7Jpkh4JKuVyt8IIy7DYue6UQxrdClz0W71ty4=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/mermaid.min.725f44bd345b0a2a4043ca952b0863edd789e913cf0813a12bbdfe986fe87079.js integrity="sha256-cl9EvTRbCipAQ8qVKwhj7deJ6RPPCBOhK73+mG/ocHk="></script>
<script defer crossorigin=anonymous src=/js/tabs.min.2d019e9ee3574770ad4ecfd4f5f794739892195cb82a4e6383252b9074ab520c.js integrity="sha256-LQGenuNXR3CtTs/U9feUc5iSGVy4Kk5jgyUrkHSrUgw="></script>
<link rel=icon href=https://andydote.co.uk/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://andydote.co.uk/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://andydote.co.uk/favicon-32x32.png><link rel=apple-touch-icon href=https://andydote.co.uk/apple-touch-icon.png><link rel=mask-icon href=https://andydote.co.uk/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://andydote.co.uk/rss.xml><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Andy Dote"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://andydote.co.uk/"><meta name=twitter:card content="summary"><meta name=twitter:title content="Andy Dote"><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"Andy Dote","url":"https://andydote.co.uk","description":"","thumbnailUrl":"https://andydote.co.uk/favicon.ico","sameAs":[]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://andydote.co.uk accesskey=h title="Andy Dote (Alt + H)">Andy Dote</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://andydote.co.uk/archive title=Archive><span>Archive</span></a></li><li><a href=https://andydote.co.uk/talks title=Talks><span>Talks</span></a></li><li><a href=https://andydote.co.uk/notes title=Notes><span>Notes</span></a></li><li><a href=https://andydote.co.uk/tags title=Tags><span>Tags</span></a></li><li><a href=https://andydote.co.uk/contact title=Contact><span>Contact</span></a></li><li><a href=https://andydote.co.uk/rss.xml title=RSS><span>RSS</span></a></li></ul></nav></header><main class=main><article class=post-entry><header class=entry-header><h2>Better BASHing Through Technology</h2></header><div class=entry-content><p>I write a lot of bash scripts for both my day job and my personal projects, and while they are functional, bash scripts always seem to lack that structure that I want, especially when compared to writing something in Go or C#. The main problem I have with bash scripts is that when I use functions, I lose the ability to log things.
For example the get_config_path function will print the path to the configuration file, which will get consumed by the do_work function:...</p></div><footer class=entry-footer><span title='2020-08-28 00:00:00 +0000 UTC'>August 28, 2020</span>&nbsp;·&nbsp;5 min</footer><a class=entry-link aria-label="post link to Better BASHing Through Technology" href=https://andydote.co.uk/2020/08/28/better-bashing-through-technology/></a></article><article class=post-entry><header class=entry-header><h2>Sharing Docker Layers Between Build Agents</h2></header><div class=entry-content><p>Recently, I noticed that when we pull a new version of our application’s docker container, it fetches all layers, not just the ones that change.
The problem is that we use ephemeral build agents, which means that each version of the application is built using a different agent, so Docker doesn’t know how to share the layers used. While we can pull the published container before we run the build, this only helps with the final stage of the build....</p></div><footer class=entry-footer><span title='2020-05-14 00:00:00 +0000 UTC'>May 14, 2020</span>&nbsp;·&nbsp;4 min</footer><a class=entry-link aria-label="post link to Sharing Docker Layers Between Build Agents" href=https://andydote.co.uk/2020/05/14/docker-layer-sharing/></a></article><article class=post-entry><header class=entry-header><h2>Service Mesh with Consul Connect (and Nomad)</h2></header><div class=entry-content><p>When it comes to implementing a new feature in an application’s ecosystem, I don’t like spending my innovation tokens unless I have to, so I try not to add new tools to my infrastructure unless I really need them.
This same approach comes when I either want, need, or have been told, to implement a Service Mesh. This means I don’t instantly setup Istio. Not because it’s bad - far from it - but because it’s extra complexity I would rather avoid, unless I need it....</p></div><footer class=entry-footer><span title='2020-05-04 00:00:00 +0000 UTC'>May 4, 2020</span>&nbsp;·&nbsp;6 min</footer><a class=entry-link aria-label="post link to Service Mesh with Consul Connect (and Nomad)" href=https://andydote.co.uk/2020/05/04/service-mesh-consul-connect/></a></article><article class=post-entry><header class=entry-header><h2>Observability Without Honeycomb</h2></header><div class=entry-content><p>Before I start on this, I want to make it clear that if you can buy Honeycomb, you should. Outlined below is how I started to add observability to an existing codebase which already had the ELK stack available, and was unable to use Honeycomb. My hope, in this case, is that I can demonstrate how much value observability gives, and also show how much more value you would get with an excellent tool, such as Honeycomb....</p></div><footer class=entry-footer><span title='2020-03-15 00:00:00 +0000 UTC'>March 15, 2020</span>&nbsp;·&nbsp;7 min</footer><a class=entry-link aria-label="post link to Observability Without Honeycomb" href=https://andydote.co.uk/2020/03/15/observability-without-honeycomb/></a></article><article class=post-entry><header class=entry-header><h2>Nomad Isolated Exec</h2></header><div class=entry-content><p>One of the many features of Nomad that I like is the ability to run things other than Docker containers. It has built-in support for Java, QEMU, and Rkt, although the latter is deprecated. Besides these inbuilt “Task Drivers” there are community maintained ones too, covering Podman, LXC, Firecraker and BSD Jails, amongst others.
The one I want to talk about today, however, is called exec. This Task Driver runs any given executable, so if you have an application which you don’t want (or can’t) put into a container, you can still schedule it with Nomad....</p></div><footer class=entry-footer><span title='2020-02-29 00:00:00 +0000 UTC'>February 29, 2020</span>&nbsp;·&nbsp;4 min</footer><a class=entry-link aria-label="post link to Nomad Isolated Exec" href=https://andydote.co.uk/2020/02/29/nomad-isolated-exec/></a></article><article class=post-entry><header class=entry-header><h2>Consul DNS Fowarding in Alpine, revisited</h2></header><div class=entry-content><p>I noticed when running an Alpine based virtual machine with Consul DNS forwarding set up, that sometimes the machine couldn’t resolve *.consul domains, but not in a consistent manner. Inspecting the logs looked like the request was being made and responded to successfully, but the result was being ignored.
After a lot of googling and frustration, I was able to track down that it’s down to a difference (or optimisation) in musl libc, which glibc doesn’t do....</p></div><footer class=entry-footer><span title='2019-12-30 00:00:00 +0000 UTC'>December 30, 2019</span>&nbsp;·&nbsp;4 min</footer><a class=entry-link aria-label="post link to Consul DNS Fowarding in Alpine, revisited" href=https://andydote.co.uk/2019/12/30/consul-alpine-dns-revisited/></a></article><article class=post-entry><header class=entry-header><h2>Libvirt Hostname Resolution</h2></header><div class=entry-content><p>I use Vagrant when testing new machines and experimenting locally with clusters, and since moving (mostly) to Linux, I have been using the LibVirt Plugin to create the virtual machines. Not only is it significantly faster than Hyper-V was on windows, but it also means I don’t need to use Oracle products, so it’s win-win really.
The only configuration challenge I have had with it is setting up VM hostname resolution, and as I forget how to do it each time, I figured I should write about it....</p></div><footer class=entry-footer><span title='2019-12-22 00:00:00 +0000 UTC'>December 22, 2019</span>&nbsp;·&nbsp;3 min</footer><a class=entry-link aria-label="post link to Libvirt Hostname Resolution" href=https://andydote.co.uk/2019/12/22/libvirt-hostname-resolution/></a></article><article class=post-entry><header class=entry-header><h2>Nomad Good, Kubernetes Bad</h2></header><div class=entry-content><p>I will update this post as I learn more (both positive and negative), and is here to be linked to when people ask me why I don’t like Kubernetes, and why I would pick Nomad in most situations if I chose to use an orchestrator at all.
TLDR: I don’t like complexity, and Kubernetes has more complexity than benefits.
Operational Complexity Operating Nomad is very straight forward. There are very few moving parts, so the number of things which can go wrong is significantly reduced....</p></div><footer class=entry-footer><span title='2019-11-21 00:00:00 +0000 UTC'>November 21, 2019</span>&nbsp;·&nbsp;6 min</footer><a class=entry-link aria-label="post link to Nomad Good, Kubernetes Bad" href=https://andydote.co.uk/2019/11/21/nomad-good-kubernetes-bad/></a></article><article class=post-entry><header class=entry-header><h2>Creating a Vault instance with a TLS Consul Cluster</h2></header><div class=entry-content><p>So we want to set up a Vault instance, and have it’s storage be a TLS based Consul cluster. The problem is that the Consul cluster needs Vault to create the certificates for TLS, which is quite the catch-22. Luckily for us, quite easy to solve:
Start a temporary Vault instance as an intermediate ca Launch Consul cluster, using Vault to generate certificates Destroy temporary Vault instance Start a permanent Vault instance, with Consul as the store Reprovision the Consul cluster with certificates from the new Vault instance There is a repository on Github with all the scripts used, and a few more details on some options....</p></div><footer class=entry-footer><span title='2019-10-06 00:00:00 +0000 UTC'>October 6, 2019</span>&nbsp;·&nbsp;3 min</footer><a class=entry-link aria-label="post link to Creating a Vault instance with a TLS Consul Cluster" href=https://andydote.co.uk/2019/10/06/vault-consul-bootstrap/></a></article><article class=post-entry><header class=entry-header><h2>Consul DNS Fowarding in Ubuntu, revisited</h2></header><div class=entry-content><p>I was recently using my Hashibox for a test, and I noticed the DNS resolution didn’t seem to work. This was a bit worrying, as I have written about how to do DNS resolution with Consul forwarding in Ubuntu, and apparently something is wrong with how I do it. Interestingly, the Alpine version works fine, so it appears there is something not quite working with how I am configuring Systemd-resolved....</p></div><footer class=entry-footer><span title='2019-09-24 00:00:00 +0000 UTC'>September 24, 2019</span>&nbsp;·&nbsp;7 min</footer><a class=entry-link aria-label="post link to Consul DNS Fowarding in Ubuntu, revisited" href=https://andydote.co.uk/2019/09/24/consul-ubuntu-dns-revisited/></a></article><footer class=page-footer><nav class=pagination><a class=prev href=https://andydote.co.uk/page/3/>« Prev Page</a>
<a class=next href=https://andydote.co.uk/page/5/>Next Page »</a></nav></footer></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>
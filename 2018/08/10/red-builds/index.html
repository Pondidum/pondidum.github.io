<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Branching and Red Builds | Andy Dote</title>
<meta name=keywords content="rant,git,ci,process,productivity,testing"><meta name=description content="So this is a bit of a rant&mldr;but hopefully with some solutions and workarounds too. So let&rsquo;s kick things off with a nice statement:
I hate broken builds.
So everyone basically agrees on this point I think. The problem is that I mean all builds, including ones on shared feature branches.
Currently, I work on a number of projects which uses small(ish) feature branches. The way this works is that the team agrees on a new feature to work on creates a branch, and then each developer works on tasks, committing on their own branches, and Pull-Requesting to the feature branch."><meta name=author content><link rel=canonical href=https://andydote.co.uk/2018/08/10/red-builds/><link crossorigin=anonymous href=/assets/css/stylesheet.min.d3aaf8cdcec9a6487824ab95cadf08232ec362e7ba510c6b742973d16ef5b72e.css integrity="sha256-06r4zc7Jpkh4JKuVyt8IIy7DYue6UQxrdClz0W71ty4=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/mermaid.min.c6a36963ab47314b3d95fe85a9385337e1ef8eb1c2194eecb86f178d492ab666.js integrity="sha256-xqNpY6tHMUs9lf6FqThTN+HvjrHCGU7suG8XjUkqtmY="></script><script defer crossorigin=anonymous src=/js/tabs.min.2d019e9ee3574770ad4ecfd4f5f794739892195cb82a4e6383252b9074ab520c.js integrity="sha256-LQGenuNXR3CtTs/U9feUc5iSGVy4Kk5jgyUrkHSrUgw="></script><link rel=icon href=https://andydote.co.uk/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://andydote.co.uk/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://andydote.co.uk/favicon-32x32.png><link rel=apple-touch-icon href=https://andydote.co.uk/apple-touch-icon.png><link rel=mask-icon href=https://andydote.co.uk/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Branching and Red Builds"><meta property="og:description" content="So this is a bit of a rant&mldr;but hopefully with some solutions and workarounds too. So let&rsquo;s kick things off with a nice statement:
I hate broken builds.
So everyone basically agrees on this point I think. The problem is that I mean all builds, including ones on shared feature branches.
Currently, I work on a number of projects which uses small(ish) feature branches. The way this works is that the team agrees on a new feature to work on creates a branch, and then each developer works on tasks, committing on their own branches, and Pull-Requesting to the feature branch."><meta property="og:type" content="article"><meta property="og:url" content="https://andydote.co.uk/2018/08/10/red-builds/"><meta property="og:image" content="https://andydote.co.uk/2018/08/10/red-builds/branching-features-builds.png"><meta property="article:section" content="post"><meta property="article:published_time" content="2018-08-10T00:00:00+00:00"><meta property="article:modified_time" content="2018-08-10T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://andydote.co.uk/2018/08/10/red-builds/branching-features-builds.png"><meta name=twitter:title content="Branching and Red Builds"><meta name=twitter:description content="So this is a bit of a rant&mldr;but hopefully with some solutions and workarounds too. So let&rsquo;s kick things off with a nice statement:
I hate broken builds.
So everyone basically agrees on this point I think. The problem is that I mean all builds, including ones on shared feature branches.
Currently, I work on a number of projects which uses small(ish) feature branches. The way this works is that the team agrees on a new feature to work on creates a branch, and then each developer works on tasks, committing on their own branches, and Pull-Requesting to the feature branch."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://andydote.co.uk/post/"},{"@type":"ListItem","position":3,"name":"Branching and Red Builds","item":"https://andydote.co.uk/2018/08/10/red-builds/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Branching and Red Builds","name":"Branching and Red Builds","description":"So this is a bit of a rant\u0026hellip;but hopefully with some solutions and workarounds too. So let\u0026rsquo;s kick things off with a nice statement:\nI hate broken builds.\nSo everyone basically agrees on this point I think. The problem is that I mean all builds, including ones on shared feature branches.\nCurrently, I work on a number of projects which uses small(ish) feature branches. The way this works is that the team agrees on a new feature to work on creates a branch, and then each developer works on tasks, committing on their own branches, and Pull-Requesting to the feature branch.","keywords":["rant","git","ci","process","productivity","testing"],"articleBody":"So this is a bit of a rant…but hopefully with some solutions and workarounds too. So let’s kick things off with a nice statement:\nI hate broken builds.\nSo everyone basically agrees on this point I think. The problem is that I mean all builds, including ones on shared feature branches.\nCurrently, I work on a number of projects which uses small(ish) feature branches. The way this works is that the team agrees on a new feature to work on creates a branch, and then each developer works on tasks, committing on their own branches, and Pull-Requesting to the feature branch. Once the feature branch is completed, it’s deployed and merged to master. We’ll ignore the fact that Trunk Based Development is just better for now.\nThe problem occurs when one of the first tasks to be completed is writing behaviour (or acceptance) tests. These are written in something like SpecFlow, and call out to stubbed methods which throw NotImplementedException s. When this gets merged, the feature branch build goes red and stays red until all other tasks are done. And probably for a little while afterwards too. Nothing like “red-green-refactor” when your light can’t change away from red!\nThe Problems Local tests are failing, no matter how much you implement PullRequests to the feature branch don’t have passing build checks The failing build is failing because: Not everything is implemented yet A developer has introduced an error, and no one has noticed yet The build machine is playing up Bad Solutions The first thing we could do is to not run the acceptance tests on a Task branch’s build, and only when a feature branch build runs. This is a bad idea, as someone will have forgotten to check if their task’s acceptance tests pass, and will require effort later to fix the broken acceptance tests.\nWe could also implement the acceptance file and not call any stubbed methods, making the file a text file and non-executable. This is also a pretty bad idea - how much would you like to bet that it stays non-executable?\nThe Solution Don’t have the acceptance tests as a separate task. Instead, split the criteria among the implementation tasks. This does mean that your other tasks should be Vertical Slices rather than Horizontal, which can be difficult to do depending on the application’s architecture.\nAn Example So let’s dream up a super simple Acceptance Criteria:\nWhen a user signs up with a valid email which has not been used, they receive a welcome email with an activation link. When a user signs up with an invalid email, they get a validation error. When a user signs up with an in-use email, they get an error Note how this is already pretty close to being the tasks for the feature? Our tasks are pretty much:\nimplement the happy path implement other scenarios Of course, this means that not everything can be done in parallel - I imagine you’d want the happy path task to be done first, and then the other scenarios are probably parallelisable.\nSo our trade-off here is that we lose some parallelisation, but gain feedback. While this may seem insignificant, it has a significant impact on the overall delivery rate - everyone knows if their tasks are complete or not, and when the build goes red, you can be sure of what introduced the problem.\nNot to mention that features are rarely this small - you probably have various separate acceptance criteria, such as being able to view an account page.\nOh, and once you can split your tasks correctly, there is only a small step to getting to do Trunk Based Development. Which would make me happy.\nAnd developer happiness is important.\n","wordCount":"622","inLanguage":"en","datePublished":"2018-08-10T00:00:00Z","dateModified":"2018-08-10T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://andydote.co.uk/2018/08/10/red-builds/"},"publisher":{"@type":"Organization","name":"Andy Dote","logo":{"@type":"ImageObject","url":"https://andydote.co.uk/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://andydote.co.uk accesskey=h title="Andy Dote (Alt + H)">Andy Dote</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://andydote.co.uk/archive title=Archive><span>Archive</span></a></li><li><a href=https://andydote.co.uk/talks title=Talks><span>Talks</span></a></li><li><a href=https://andydote.co.uk/notes title=Notes><span>Notes</span></a></li><li><a href=https://andydote.co.uk/tags title=Tags><span>Tags</span></a></li><li><a href=https://andydote.co.uk/contact title=Contact><span>Contact</span></a></li><li><a href=https://andydote.co.uk/rss.xml title=RSS><span>RSS</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Branching and Red Builds</h1><div class=post-meta>&lt;span title='2018-08-10 00:00:00 +0000 UTC'>August 10, 2018&lt;/span>&amp;nbsp;·&amp;nbsp;3 min</div></header><div class=post-content><p>So this is a bit of a rant&mldr;but hopefully with some solutions and workarounds too. So let&rsquo;s kick things off with a nice statement:</p><p>I hate broken builds.</p><p>So everyone basically agrees on this point I think. The problem is that I mean <em>all</em> builds, including ones on shared feature branches.</p><p>Currently, I work on a number of projects which uses small(ish) feature branches. The way this works is that the team agrees on a new feature to work on creates a branch, and then each developer works on tasks, committing on their own branches, and Pull-Requesting to the feature branch. Once the feature branch is completed, it&rsquo;s deployed and merged to master. We&rsquo;ll ignore the fact that Trunk Based Development is just better for now.</p><p><img loading=lazy src=branching-features.png alt="branching, developers working on small tasks being merged into a feature branch"></p><p>The problem occurs when one of the first tasks to be completed is writing behaviour (or acceptance) tests. These are written in something like SpecFlow, and call out to stubbed methods which throw <code>NotImplementedException</code> s. When this gets merged, the feature branch build goes red and stays red until all other tasks are done. And probably for a little while afterwards too. Nothing like &ldquo;red-green-refactor&rdquo; when your light can&rsquo;t change away from red!</p><h2 id=the-problems>The Problems<a hidden class=anchor aria-hidden=true href=#the-problems>#</a></h2><ul><li>Local tests are failing, no matter how much you implement</li><li>PullRequests to the feature branch don&rsquo;t have passing build checks</li><li>The failing build is failing because:<ul><li>Not everything is implemented yet</li><li>A developer has introduced an error, and no one has noticed yet</li><li>The build machine is playing up</li></ul></li></ul><p><img loading=lazy src=branching-features-builds.png alt="branching, developers working on small tasks being merged into a feature branch showing everything as failed builds"></p><h2 id=bad-solutions>Bad Solutions<a hidden class=anchor aria-hidden=true href=#bad-solutions>#</a></h2><p>The first thing we could do is to not run the acceptance tests on a Task branch&rsquo;s build, and only when a feature branch build runs. This is a bad idea, as someone will have forgotten to check if their task&rsquo;s acceptance tests pass, and will require effort later to fix the broken acceptance tests.</p><p>We could also implement the acceptance file and not call any stubbed methods, making the file a text file and non-executable. This is also a pretty bad idea - how much would you like to bet that it stays non-executable?</p><h2 id=the-solution>The Solution<a hidden class=anchor aria-hidden=true href=#the-solution>#</a></h2><p>Don&rsquo;t have the acceptance tests as a separate task. Instead, split the criteria among the implementation tasks. This does mean that your other tasks should be Vertical Slices rather than Horizontal, which can be difficult to do depending on the application&rsquo;s architecture.</p><h2 id=an-example>An Example<a hidden class=anchor aria-hidden=true href=#an-example>#</a></h2><p>So let&rsquo;s dream up a super simple Acceptance Criteria:</p><ul><li>When a user signs up with a valid email which has not been used, they receive a welcome email with an activation link.</li><li>When a user signs up with an invalid email, they get a validation error.</li><li>When a user signs up with an in-use email, they get an error</li></ul><p>Note how this is already pretty close to being the tasks for the feature? Our tasks are pretty much:</p><ul><li>implement the happy path</li><li>implement other scenarios</li></ul><p>Of course, this means that not everything can be done in parallel - I imagine you&rsquo;d want the happy path task to be done first, and then the other scenarios are probably parallelisable.</p><p>So our trade-off here is that we lose some parallelisation, but gain feedback. While this may seem insignificant, it has a significant impact on the overall delivery rate - everyone knows if their tasks are complete or not, and when the build goes red, you can be sure of what introduced the problem.</p><p>Not to mention that features are rarely this small - you probably have various separate acceptance criteria, such as being able to view an account page.</p><p>Oh, and once you can split your tasks correctly, there is only a small step to getting to do Trunk Based Development. Which would make me happy.</p><p>And developer happiness is important.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://andydote.co.uk/tags/rant/>rant</a></li><li><a href=https://andydote.co.uk/tags/git/>git</a></li><li><a href=https://andydote.co.uk/tags/ci/>ci</a></li><li><a href=https://andydote.co.uk/tags/process/>process</a></li><li><a href=https://andydote.co.uk/tags/productivity/>productivity</a></li><li><a href=https://andydote.co.uk/tags/testing/>testing</a></li></ul><nav class=paginav><a class=prev href=https://andydote.co.uk/2018/08/26/validate-configuration/><span class=title>« Prev Page</span><br><span>Validate Your Configuration</span>
</a><a class=next href=https://andydote.co.uk/2018/08/07/managing-consul-appsettings/><span class=title>Next Page »</span><br><span>Managing AppSettings in Consul</span></a></nav></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>
<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Encapsulation in Warcraft Addons - Closures | Andy Dote</title><meta name=keywords content="design,lua,warcraft"><meta name=description content="In the last post I alluded to the fact that if you put in a little leg work, you could write well encapsulated objects in lua. There are two main ways to do this; with closures, and with metatables. In this post we will deal with using closures, and in the next post we will cover using metatables.
Using Closures The simplest way to write an object in lua is with a closure to hide all the variables from the outside world."><meta name=author content><link rel=canonical href=https://andydote.co.uk/2014/11/28/encapsulation-in-warcraft-addons-closures/><link crossorigin=anonymous href=/assets/css/stylesheet.min.d3aaf8cdcec9a6487824ab95cadf08232ec362e7ba510c6b742973d16ef5b72e.css integrity="sha256-06r4zc7Jpkh4JKuVyt8IIy7DYue6UQxrdClz0W71ty4=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/mermaid.min.725f44bd345b0a2a4043ca952b0863edd789e913cf0813a12bbdfe986fe87079.js integrity="sha256-cl9EvTRbCipAQ8qVKwhj7deJ6RPPCBOhK73+mG/ocHk="></script>
<script defer crossorigin=anonymous src=/js/tabs.min.2d019e9ee3574770ad4ecfd4f5f794739892195cb82a4e6383252b9074ab520c.js integrity="sha256-LQGenuNXR3CtTs/U9feUc5iSGVy4Kk5jgyUrkHSrUgw="></script>
<link rel=icon href=https://andydote.co.uk/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://andydote.co.uk/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://andydote.co.uk/favicon-32x32.png><link rel=apple-touch-icon href=https://andydote.co.uk/apple-touch-icon.png><link rel=mask-icon href=https://andydote.co.uk/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Encapsulation in Warcraft Addons - Closures"><meta property="og:description" content="In the last post I alluded to the fact that if you put in a little leg work, you could write well encapsulated objects in lua. There are two main ways to do this; with closures, and with metatables. In this post we will deal with using closures, and in the next post we will cover using metatables.
Using Closures The simplest way to write an object in lua is with a closure to hide all the variables from the outside world."><meta property="og:type" content="article"><meta property="og:url" content="https://andydote.co.uk/2014/11/28/encapsulation-in-warcraft-addons-closures/"><meta property="article:section" content="post"><meta property="article:published_time" content="2014-11-28T00:00:00+00:00"><meta property="article:modified_time" content="2014-11-28T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Encapsulation in Warcraft Addons - Closures"><meta name=twitter:description content="In the last post I alluded to the fact that if you put in a little leg work, you could write well encapsulated objects in lua. There are two main ways to do this; with closures, and with metatables. In this post we will deal with using closures, and in the next post we will cover using metatables.
Using Closures The simplest way to write an object in lua is with a closure to hide all the variables from the outside world."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://andydote.co.uk/post/"},{"@type":"ListItem","position":3,"name":"Encapsulation in Warcraft Addons - Closures","item":"https://andydote.co.uk/2014/11/28/encapsulation-in-warcraft-addons-closures/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Encapsulation in Warcraft Addons - Closures","name":"Encapsulation in Warcraft Addons - Closures","description":"In the last post I alluded to the fact that if you put in a little leg work, you could write well encapsulated objects in lua. There are two main ways to do this; with closures, and with metatables. In this post we will deal with using closures, and in the next post we will cover using metatables.\nUsing Closures The simplest way to write an object in lua is with a closure to hide all the variables from the outside world.","keywords":["design","lua","warcraft"],"articleBody":"In the last post I alluded to the fact that if you put in a little leg work, you could write well encapsulated objects in lua. There are two main ways to do this; with closures, and with metatables. In this post we will deal with using closures, and in the next post we will cover using metatables.\nUsing Closures The simplest way to write an object in lua is with a closure to hide all the variables from the outside world. For example, we can write a counter class like so:\nlocal counter = { new = function() local count = 0 local this = { increase = function() count = count + 1 end end, print = function() print(\"The count is \" .. count .. \".\") end, } return this end, } We are using a table to give us a class name, and the closure is the only method on it (called new). My standard convention is to call the actual object we return this. The this object contains the public surface of our object, in this case two methods called increase() and print(). You can use the counter like this:\nlocal first = counter.new() first.increase() first.print() -- prints \"The count is 1\" By using a closure, we limit the use of the count variable to only methods defined in the body of the function new. This prevents anyone who uses the class from knowing how it is implemented, which is important as we are now at liberty to change the implementation without affecting our users.\nA good example of this technique is in my Dark.Combat addon. While writing cooldown tracking, I needed to know how many stacks of Maelstrom Weapon was the maximum, so that I could trigger a glow effect on the icon. The problem is that the Warcraft API doesn’t have a way of querying this (you can call GetSpellCharges for spells such as Conflagurate, but sadly this doesn’t work on an aura.)\nTo solve this, rather than hard coding values into the view, or forcing the user to specify some kind of “glow at xxx stacks” parameter in the config, I wrote an object which you can be queried. This could also be expanded later to hold additional spell data which is not available in the API.\nlocal addon, ns = ... local spellData = { new = function() local charges = { [53817] = 5, [\"Maelstrom Weapon\"] = 5, [91342] = 5, [\"Shadow Infusion\"] = 5, } setmetatable(charges, { __index = function(key) return 1 end }) return { getMaxCharges = function(spellID) return charges[spellID] end, } end } ns.spellData = spellData.new() As the implementation of getMaxCharges is hidden, I can change it at will - perhaps splitting my charges table into two separate tables, or if Blizzard kindly implemented a GetMaxStacks(spellName) I could call this instead and remove my charges table altogether.\nComposition We can utilise composition to create objects based off other objects, by decorating an instance with new functionality. A slightly cut down version of the grouping code from my Dark.Bags addon makes good use of this:\nlocal group = { new = function(name, parent, options) local frame = CreateFrame(\"Frame\", name, parent), layoutEngine.init(frame, { type = \"HORIZONTAL\", wrap = true, autosize = true }) return { add = function(child) frame.add(child) end, } end, } local bag = { new = function(name, parent) local this = group.new(name, parent) this.populate = function(contents) for key, details in pairs(contents) do this.add(itemView.new(details)) end end return this end, } Here we have two classes group and bag. The group acts as our base class; it just creates a frame, and initialises a layout engine which does the heavy lifiting of laying out child frames.\nIn the bag.new() function, we create an instance of a group and add a populate method to it, and return it. We can continue creating new classes which use bag and group as base types as we need.\nProblems with Closures The down side to using closures is that inheritance is not really possible. To take the counter example again, if you wanted to create a stepping counter, you couldn’t do this:\nlocal evenCounter = { new = function() local this = counter.new() this.increase = function() -- how do we access count?! end return this end } Not only can you not access the original count variable, but you would also have to reimplement the print function as it would not have access to your new counting variable.\nThese problems can be solved using the metatables methods in the next post, however depending on what you are doing, you could just use composition instead as outlined below.\n","wordCount":"774","inLanguage":"en","datePublished":"2014-11-28T00:00:00Z","dateModified":"2014-11-28T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://andydote.co.uk/2014/11/28/encapsulation-in-warcraft-addons-closures/"},"publisher":{"@type":"Organization","name":"Andy Dote","logo":{"@type":"ImageObject","url":"https://andydote.co.uk/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://andydote.co.uk accesskey=h title="Andy Dote (Alt + H)">Andy Dote</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://andydote.co.uk/archive title=Archive><span>Archive</span></a></li><li><a href=https://andydote.co.uk/talks title=Talks><span>Talks</span></a></li><li><a href=https://andydote.co.uk/notes title=Notes><span>Notes</span></a></li><li><a href=https://andydote.co.uk/tags title=Tags><span>Tags</span></a></li><li><a href=https://andydote.co.uk/contact title=Contact><span>Contact</span></a></li><li><a href=https://andydote.co.uk/rss.xml title=RSS><span>RSS</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Encapsulation in Warcraft Addons - Closures</h1><div class=post-meta><span title='2014-11-28 00:00:00 +0000 UTC'>November 28, 2014</span>&nbsp;·&nbsp;4 min</div></header><div class=post-content><p>In the <a href=http://andydote.co.uk/2014/11/23/good-design-in-warcraft-addons.html>last post</a> I alluded to the fact that if you put in a little leg work, you could write well encapsulated objects in lua. There are two main ways to do this; with closures, and with metatables. In this post we will deal with using closures, and in the next post we will cover using metatables.</p><h2 id=using-closures>Using Closures<a hidden class=anchor aria-hidden=true href=#using-closures>#</a></h2><p>The simplest way to write an object in lua is with a <a href=http://en.wikipedia.org/wiki/Closure_(computer_programming)>closure</a> to hide all the variables from the outside world. For example, we can write a counter class like so:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#66d9ef>local</span> counter <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	new <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>local</span> count <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>local</span> this <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			increase <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>()
</span></span><span style=display:flex><span>				count <span style=color:#f92672>=</span> count <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>end</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			print <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>()
</span></span><span style=display:flex><span>				print(<span style=color:#e6db74>&#34;The count is &#34;</span> <span style=color:#f92672>..</span> count <span style=color:#f92672>..</span> <span style=color:#e6db74>&#34;.&#34;</span>)
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>end</span>,
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> this
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>end</span>,
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>We are using a table to give us a class name, and the closure is the only method on it (called <code>new</code>). My standard convention is to call the actual object we return <code>this</code>. The <code>this</code> object contains the public surface of our object, in this case two methods called <code>increase()</code> and <code>print()</code>. You can use the counter like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#66d9ef>local</span> first <span style=color:#f92672>=</span> counter.new()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>first.increase()
</span></span><span style=display:flex><span>first.print() <span style=color:#75715e>-- prints &#34;The count is 1&#34;</span>
</span></span></code></pre></div><p>By using a closure, we limit the use of the <code>count</code> variable to only methods defined in the body of the function <code>new</code>. This prevents anyone who uses the class from knowing how it is implemented, which is important as we are now at liberty to change the implementation without affecting our users.</p><p>A good example of this technique is in my <a href=https://github.com/Pondidum/Dark.Combat>Dark.Combat</a> addon. While writing cooldown tracking, I needed to know how many stacks of Maelstrom Weapon was the maximum, so that I could trigger a glow effect on the icon. The problem is that the Warcraft API doesn&rsquo;t have a way of querying this (you can call <a href=http://wowprogramming.com/docs/api/GetSpellCharges>GetSpellCharges</a> for spells such as Conflagurate, but sadly this doesn&rsquo;t work on an aura.)</p><p>To solve this, rather than hard coding values into the view, or forcing the user to specify some kind of &ldquo;glow at xxx stacks&rdquo; parameter in the config, I wrote an object which you can be queried. This could also be expanded later to hold additional spell data which is not available in the API.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#66d9ef>local</span> addon, ns <span style=color:#f92672>=</span> ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> spellData <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	new <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>local</span> charges <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>			[<span style=color:#ae81ff>53817</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>,
</span></span><span style=display:flex><span>			[<span style=color:#e6db74>&#34;Maelstrom Weapon&#34;</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			[<span style=color:#ae81ff>91342</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>,
</span></span><span style=display:flex><span>			[<span style=color:#e6db74>&#34;Shadow Infusion&#34;</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>,
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		setmetatable(charges, { __index <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(key) <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>end</span> })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>			getMaxCharges <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(spellID)
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> charges[spellID]
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>end</span>,
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ns.spellData <span style=color:#f92672>=</span> spellData.new()
</span></span></code></pre></div><p>As the implementation of <code>getMaxCharges</code> is hidden, I can change it at will - perhaps splitting my <code>charges</code> table into two separate tables, or if Blizzard kindly implemented a <code>GetMaxStacks(spellName)</code> I could call this instead and remove my <code>charges</code> table altogether.</p><h3 id=composition>Composition<a hidden class=anchor aria-hidden=true href=#composition>#</a></h3><p>We can utilise composition to create objects based off other objects, by decorating an instance with new functionality. A slightly cut down version of the grouping code from my <a href=https://github.com/Pondidum/Dark.Bags/tree/master/groups>Dark.Bags addon</a> makes good use of this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#66d9ef>local</span> group <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	new <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(name, parent, options)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>local</span> frame <span style=color:#f92672>=</span> CreateFrame(<span style=color:#e6db74>&#34;Frame&#34;</span>, name, parent),
</span></span><span style=display:flex><span>		layoutEngine.init(frame, { type <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;HORIZONTAL&#34;</span>, wrap <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>, autosize <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span> })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>			add <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(child)
</span></span><span style=display:flex><span>				frame.add(child)
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>end</span>,
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>end</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> bag <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	new <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(name, parent)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>local</span> this <span style=color:#f92672>=</span> group.new(name, parent)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		this.populate <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(contents)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>for</span> key, details <span style=color:#66d9ef>in</span> pairs(contents) <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>				this.add(itemView.new(details))
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> this
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>end</span>,
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Here we have two classes <code>group</code> and <code>bag</code>. The <code>group</code> acts as our base class; it just creates a frame, and initialises a layout engine which does the heavy lifiting of laying out child frames.</p><p>In the <code>bag.new()</code> function, we create an instance of a <code>group</code> and add a <code>populate</code> method to it, and return it. We can continue creating new classes which use <code>bag</code> and <code>group</code> as base types as we need.</p><h3 id=problems-with-closures>Problems with Closures<a hidden class=anchor aria-hidden=true href=#problems-with-closures>#</a></h3><p>The down side to using closures is that inheritance is not really possible. To take the <code>counter</code> example again, if you wanted to create a stepping counter, you couldn&rsquo;t do this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> evenCounter <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>	new <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>local</span> this <span style=color:#f92672>=</span> counter.new()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		this.increase <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>()
</span></span><span style=display:flex><span>			<span style=color:#75715e>-- how do we access count?!</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> this
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Not only can you not access the original <code>count</code> variable, but you would also have to reimplement the <code>print</code> function as it would not have access to your new counting variable.</p><p>These problems can be solved using the metatables methods in the next post, however depending on what you are doing, you could just use composition instead as outlined below.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://andydote.co.uk/tags/design/>design</a></li><li><a href=https://andydote.co.uk/tags/lua/>lua</a></li><li><a href=https://andydote.co.uk/tags/warcraft/>warcraft</a></li></ul><nav class=paginav><a class=prev href=https://andydote.co.uk/2014/12/05/encapsulation-in-warcraft-addons-inheritance/><span class=title>« Prev Page</span><br><span>Encapsulation in Warcraft Addons - Inheritance</span></a>
<a class=next href=https://andydote.co.uk/2014/11/23/good-design-in-warcraft-addons/><span class=title>Next Page »</span><br><span>Good Design in Warcraft Addons/Lua</span></a></nav></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>
<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Edge.js for Embedded Webuis | Andy Dote</title><meta name=keywords content="design,c#,typing,sql,database,orm"><meta name=description content="We work we have a number of windows services which each have a lot of stats they could expose. Currently they are only interrogatable by the logfiles and from any notifications we receive.
I have been toying with the idea of hosting a website in-process which would give a simple dashboard ui and access to a live view of the log file. The idea first struck me when I was experimenting with FubuMvc, as they have an EmbeddedFubuMvcServer, which is very easy to use:"><meta name=author content><link rel=canonical href=https://andydote.co.uk/2014/08/04/edgejs-for-embedded-webuis/><link crossorigin=anonymous href=/assets/css/stylesheet.min.b4e19c453811e60acfec1f00c15ac2be1c53f6ab90187e684358ce7faaf48bab.css integrity="sha256-tOGcRTgR5grP7B8AwVrCvhxT9quQGH5oQ1jOf6r0i6s=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.e85ad0406048e8176e1c7661b25d5c69297ddfe41dc4124cf75ecb99a4f7b3d1.js integrity="sha256-6FrQQGBI6BduHHZhsl1caSl93+QdxBJM917LmaT3s9E=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://andydote.co.uk/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://andydote.co.uk/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://andydote.co.uk/favicon-32x32.png><link rel=apple-touch-icon href=https://andydote.co.uk/apple-touch-icon.png><link rel=mask-icon href=https://andydote.co.uk/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Edge.js for Embedded Webuis"><meta property="og:description" content="We work we have a number of windows services which each have a lot of stats they could expose. Currently they are only interrogatable by the logfiles and from any notifications we receive.
I have been toying with the idea of hosting a website in-process which would give a simple dashboard ui and access to a live view of the log file. The idea first struck me when I was experimenting with FubuMvc, as they have an EmbeddedFubuMvcServer, which is very easy to use:"><meta property="og:type" content="article"><meta property="og:url" content="https://andydote.co.uk/2014/08/04/edgejs-for-embedded-webuis/"><meta property="article:section" content="post"><meta property="article:published_time" content="2014-08-04T00:00:00+00:00"><meta property="article:modified_time" content="2014-08-04T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Edge.js for Embedded Webuis"><meta name=twitter:description content="We work we have a number of windows services which each have a lot of stats they could expose. Currently they are only interrogatable by the logfiles and from any notifications we receive.
I have been toying with the idea of hosting a website in-process which would give a simple dashboard ui and access to a live view of the log file. The idea first struck me when I was experimenting with FubuMvc, as they have an EmbeddedFubuMvcServer, which is very easy to use:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://andydote.co.uk/post/"},{"@type":"ListItem","position":3,"name":"Edge.js for Embedded Webuis","item":"https://andydote.co.uk/2014/08/04/edgejs-for-embedded-webuis/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Edge.js for Embedded Webuis","name":"Edge.js for Embedded Webuis","description":"We work we have a number of windows services which each have a lot of stats they could expose. Currently they are only interrogatable by the logfiles and from any notifications we receive.\nI have been toying with the idea of hosting a website in-process which would give a simple dashboard ui and access to a live view of the log file. The idea first struck me when I was experimenting with FubuMvc, as they have an EmbeddedFubuMvcServer, which is very easy to use:","keywords":["design","c#","typing","sql","database","orm"],"articleBody":"We work we have a number of windows services which each have a lot of stats they could expose. Currently they are only interrogatable by the logfiles and from any notifications we receive.\nI have been toying with the idea of hosting a website in-process which would give a simple dashboard ui and access to a live view of the log file. The idea first struck me when I was experimenting with FubuMvc, as they have an EmbeddedFubuMvcServer, which is very easy to use:\nFubuMvcPackageFacility.PhysicalRootPath = @\"Backend\\\"; using (var server = EmbeddedFubuMvcServer.For(FubuMvcPackageFacility.PhysicalRootPath)) { Console.WriteLine(\"Some long running process, with a web-backend on :5500\"); var p = server.Services.GetInstance(); var t = new Task(p.Start); t.Start(); Console.ReadKey(); } But while I like this, FubuMvc embedded seems like overkill.\nWouldn’t it be nice if we could host an expressjs app inside our process? They are very lightweight, and to get one setup is almost no coding (especially if you use the express commandline tool).\nEnter Edgejs The Edge.js project provides an in-process bridge between the .net and nodejs worlds, and allows for communication between the two…\nSteps:\nCreate a new application (eg: ServiceWithEdge)\nCreate a subdirectory for the webui in your applications root (eg, next to the csproj file)\nServiceWithEdge\\ServiceWithEdge\\webui If you don’t have express-generator installed, get it:\nnpm install -g express-generator Cd to your webui directory, and create an express application:\nexpress - there are some options if you want, see the guide In visual studio, include the webui directory\nMark all files as content and copy if newer Add a new js file in your webui root:\nvar options; exports.set = function (m) { options = m; }; exports.getModel = function (modelName, action) { options.getModel(modelName, function (error, result) { if (error) throw error; action(result); }); }; add the edgejs package:\nPM\u003e install-package edge.js The following function will run the webui, and inject a callback for getting models from .net\nprivate static void RunWebui(ModelStore store) { var func = Edge.Func(@\" var app = require('../webui/app'); var com = require('../webui/communicator'); app.set('port', process.env.PORT || 3000); var server = app.listen(app.get('port')); return function(options, callback) { com.set(options); }; \"); var getModel = (Func\u003cobject, Task\u003cobject\u003e\u003e)(async (message) =\u003e { return store.GetModel((string)message); }); Task.Run(() =\u003e func(new { getModel })); } The last step to getting this to work is running npm install in the webui directory of the build output folder. I use a rake file to build everything, so its just an extra task (see the entire Rakefile here): task :npm do |t| Dir.chdir \"#{project_name}/bin/debug/webui\" do system 'npm', 'install' end end ny route needing data from .net just needs to require the communicator file and call `getModel`: var com = require('../communicator'); router.get('/', function (req, res) { com.getModel(\"index\", function(value) { res.render('index', { title: 'Express', result: value.Iterations }); }); }); All the code is available on github.\nHow I am aiming to use it I am planning on constructing a nuget package to do all of this, so that all a developer needs to do is add the package, and configure which statistics they wish to show up on the web ui.\n","wordCount":"508","inLanguage":"en","datePublished":"2014-08-04T00:00:00Z","dateModified":"2014-08-04T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://andydote.co.uk/2014/08/04/edgejs-for-embedded-webuis/"},"publisher":{"@type":"Organization","name":"Andy Dote","logo":{"@type":"ImageObject","url":"https://andydote.co.uk/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://andydote.co.uk accesskey=h title="Andy Dote (Alt + H)">Andy Dote</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://andydote.co.uk/archive title=Archive><span>Archive</span></a></li><li><a href=https://andydote.co.uk/talks title=Talks><span>Talks</span></a></li><li><a href=https://andydote.co.uk/notes title=Notes><span>Notes</span></a></li><li><a href=https://andydote.co.uk/tags title=Tags><span>Tags</span></a></li><li><a href=https://andydote.co.uk/contact title=Contact><span>Contact</span></a></li><li><a href=https://andydote.co.uk/rss.xml title=RSS><span>RSS</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Edge.js for Embedded Webuis</h1><div class=post-meta><span title='2014-08-04 00:00:00 +0000 UTC'>August 4, 2014</span>&nbsp;·&nbsp;3 min</div></header><div class=post-content><p>We work we have a number of windows services which each have a lot of stats they could expose. Currently they are only interrogatable by the logfiles and from any notifications we receive.</p><p>I have been toying with the idea of hosting a website in-process which would give a simple dashboard ui and access to a live view of the log file. The idea first struck me when I was experimenting with FubuMvc, as they have an <code>EmbeddedFubuMvcServer</code>, which is very easy to use:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>FubuMvcPackageFacility.PhysicalRootPath = <span style=color:#e6db74>@&#34;Backend\&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> (<span style=color:#66d9ef>var</span> server = EmbeddedFubuMvcServer.For&lt;EmbeddedBackend&gt;(FubuMvcPackageFacility.PhysicalRootPath))
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Console.WriteLine(<span style=color:#e6db74>&#34;Some long running process, with a web-backend on :5500&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> p = server.Services.GetInstance&lt;IProcessor&gt;();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> t = <span style=color:#66d9ef>new</span> Task(p.Start);
</span></span><span style=display:flex><span>    t.Start();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Console.ReadKey();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>But while I like this, FubuMvc embedded seems like overkill.</p><p>Wouldn&rsquo;t it be nice if we could host an <code>expressjs</code> app inside our process? They are very lightweight, and to get one setup is almost no coding (especially if you use the express commandline tool).</p><h2 id=enter-edgejs>Enter Edgejs<a hidden class=anchor aria-hidden=true href=#enter-edgejs>#</a></h2><p>The <a href=http://tjanczuk.github.io/edge/>Edge.js</a> project provides an in-process bridge between the .net and nodejs worlds, and allows for communication between the two&mldr;</p><p>Steps:</p><ul><li><p>Create a new application (eg: ServiceWithEdge)</p></li><li><p>Create a subdirectory for the webui in your applications root (eg, next to the csproj file)</p><ul><li>ServiceWithEdge\ServiceWithEdge\webui</li></ul></li><li><p>If you don&rsquo;t have express-generator installed, get it:</p><ul><li><code>npm install -g express-generator</code></li></ul></li><li><p>Cd to your webui directory, and create an express application:</p><ul><li><code>express</code> - there are some options if you want, see <a href=http://expressjs.com/guide.html#executable>the guide</a></li></ul></li><li><p>In visual studio, include the webui directory</p><ul><li>Mark all files as <code>content</code> and <code>copy if newer</code></li></ul></li><li><p>Add a new js file in your webui root:</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>var</span> options;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>exports.<span style=color:#66d9ef>set</span> = function (m) {
</span></span><span style=display:flex><span>    options = m;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>exports.getModel = function (modelName, action) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    options.getModel(modelName, function (error, result) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (error) <span style=color:#66d9ef>throw</span> error;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        action(result);
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><ul><li><p>add the edgejs package:</p><ul><li><code>PM> install-package edge.js</code></li></ul></li><li><p>The following function will run the webui, and inject a callback for getting models from .net</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> RunWebui(ModelStore store)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> func = Edge.Func(<span style=color:#e6db74>@&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>		var app = require(&#39;../webui/app&#39;);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>		var com = require(&#39;../webui/communicator&#39;);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>		app.set(&#39;port&#39;, process.env.PORT || 3000);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>		var server = app.listen(app.get(&#39;port&#39;));
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>		return function(options, callback) {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>			com.set(options);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>		};
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> getModel = (Func&lt;<span style=color:#66d9ef>object</span>, Task&lt;<span style=color:#66d9ef>object</span>&gt;&gt;)(<span style=color:#66d9ef>async</span> (message) =&gt;
</span></span><span style=display:flex><span>	{
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> store.GetModel((<span style=color:#66d9ef>string</span>)message);
</span></span><span style=display:flex><span>	});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	Task.Run(() =&gt; func(<span style=color:#66d9ef>new</span>
</span></span><span style=display:flex><span>	{
</span></span><span style=display:flex><span>		getModel
</span></span><span style=display:flex><span>	}));
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>The last step to getting this to work is running <code>npm install</code> in the webui directory <strong>of the build output folder</strong>. I use a rake file to build everything, so its just an extra task (see the entire Rakefile <a href=https://github.com/Pondidum/ServiceWithEdge/blob/master/Rakefile>here</a>):</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span>task <span style=color:#e6db74>:npm</span> <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>t<span style=color:#f92672>|</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>Dir</span><span style=color:#f92672>.</span>chdir <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>#{</span>project_name<span style=color:#e6db74>}</span><span style=color:#e6db74>/bin/debug/webui&#34;</span> <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>		system <span style=color:#e6db74>&#39;npm&#39;</span>, <span style=color:#e6db74>&#39;install&#39;</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div><pre><code>ny route needing data from .net just needs to require the communicator file and call `getModel`:
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>com</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;../communicator&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>router</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/&#39;</span>, <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>com</span>.<span style=color:#a6e22e>getModel</span>(<span style=color:#e6db74>&#34;index&#34;</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>value</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>render</span>(<span style=color:#e6db74>&#39;index&#39;</span>, {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>title</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Express&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>result</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>value</span>.<span style=color:#a6e22e>Iterations</span>
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>All the code is <a href=https://github.com/Pondidum/ServiceWithEdge>available on github</a>.</p><h2 id=how-i-am-aiming-to-use-it>How I am aiming to use it<a hidden class=anchor aria-hidden=true href=#how-i-am-aiming-to-use-it>#</a></h2><p>I am planning on constructing a nuget package to do all of this, so that all a developer needs to do is add the package, and configure which statistics they wish to show up on the web ui.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://andydote.co.uk/tags/design/>design</a></li><li><a href=https://andydote.co.uk/tags/c#/>c#</a></li><li><a href=https://andydote.co.uk/tags/typing/>typing</a></li><li><a href=https://andydote.co.uk/tags/sql/>sql</a></li><li><a href=https://andydote.co.uk/tags/database/>database</a></li><li><a href=https://andydote.co.uk/tags/orm/>orm</a></li></ul><nav class=paginav><a class=prev href=https://andydote.co.uk/2014/11/23/good-design-in-warcraft-addons/><span class=title>« Prev Page</span><br><span>Good Design in Warcraft Addons/Lua</span></a>
<a class=next href=https://andydote.co.uk/2014/07/22/configuring-dapper-to-work-with-custom-types/><span class=title>Next Page »</span><br><span>Configuring Dapper to work with custom types</span></a></nav></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>
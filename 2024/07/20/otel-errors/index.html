<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Multiple errors in an OTEL Span | Andy Dote</title><meta name=keywords content="opentelemetry"><meta name=description content="A question at work came up recently about how to handle multiple errors in a single span. My reaction is that having multiple errors in a span is a design smell, but I had no particular data or spec to back this up, just a gut feeling. I&rsquo;ve since thought about this more and think that in general, you should only have one error per span, but there are circumstances where multiple indeed makes sense."><meta name=author content><link rel=canonical href=https://andydote.co.uk/2024/07/20/otel-errors/><link crossorigin=anonymous href=/assets/css/stylesheet.min.d3aaf8cdcec9a6487824ab95cadf08232ec362e7ba510c6b742973d16ef5b72e.css integrity="sha256-06r4zc7Jpkh4JKuVyt8IIy7DYue6UQxrdClz0W71ty4=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/mermaid.min.725f44bd345b0a2a4043ca952b0863edd789e913cf0813a12bbdfe986fe87079.js integrity="sha256-cl9EvTRbCipAQ8qVKwhj7deJ6RPPCBOhK73+mG/ocHk="></script>
<script defer crossorigin=anonymous src=/js/tabs.min.2d019e9ee3574770ad4ecfd4f5f794739892195cb82a4e6383252b9074ab520c.js integrity="sha256-LQGenuNXR3CtTs/U9feUc5iSGVy4Kk5jgyUrkHSrUgw="></script>
<link rel=icon href=https://andydote.co.uk/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://andydote.co.uk/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://andydote.co.uk/favicon-32x32.png><link rel=apple-touch-icon href=https://andydote.co.uk/apple-touch-icon.png><link rel=mask-icon href=https://andydote.co.uk/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Multiple errors in an OTEL Span"><meta property="og:description" content="A question at work came up recently about how to handle multiple errors in a single span. My reaction is that having multiple errors in a span is a design smell, but I had no particular data or spec to back this up, just a gut feeling. I&rsquo;ve since thought about this more and think that in general, you should only have one error per span, but there are circumstances where multiple indeed makes sense."><meta property="og:type" content="article"><meta property="og:url" content="https://andydote.co.uk/2024/07/20/otel-errors/"><meta property="article:section" content="post"><meta name=twitter:card content="summary"><meta name=twitter:title content="Multiple errors in an OTEL Span"><meta name=twitter:description content="A question at work came up recently about how to handle multiple errors in a single span. My reaction is that having multiple errors in a span is a design smell, but I had no particular data or spec to back this up, just a gut feeling. I&rsquo;ve since thought about this more and think that in general, you should only have one error per span, but there are circumstances where multiple indeed makes sense."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://andydote.co.uk/post/"},{"@type":"ListItem","position":3,"name":"Multiple errors in an OTEL Span","item":"https://andydote.co.uk/2024/07/20/otel-errors/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Multiple errors in an OTEL Span","name":"Multiple errors in an OTEL Span","description":"A question at work came up recently about how to handle multiple errors in a single span. My reaction is that having multiple errors in a span is a design smell, but I had no particular data or spec to back this up, just a gut feeling. I\u0026rsquo;ve since thought about this more and think that in general, you should only have one error per span, but there are circumstances where multiple indeed makes sense.","keywords":["opentelemetry"],"articleBody":"A question at work came up recently about how to handle multiple errors in a single span. My reaction is that having multiple errors in a span is a design smell, but I had no particular data or spec to back this up, just a gut feeling. I’ve since thought about this more and think that in general, you should only have one error per span, but there are circumstances where multiple indeed makes sense. So, let’s dig into them.\nCan I have multiple errors in a Span? Yes! An error is stored as an event attached to the span, so calling span.recordError(err) can be called multiple times. However, a span can only have one status: either Unset, Ok, or Error, so while many errors can be recorded, the status of the span can only be set to one value.\nMultiple unrelated errors The problem with wanting to store multiple errors in one trace is that while you can have multiple error events, if you are also using the span’s attributes for the error details (i.e. setting err.message and err.details etc.) then whichever was your last error will overwrite previous values.\nOne solution offered is to combine all errors into one, and then record that in the attributes. This feels like a bad idea to me due to how you consume the errors in your OTEL service of choice; generally, you filter by attributes without any kind of free text search or, at best, prefix matching.\nThis, however, means that you lose a lot of filtering ability. Rather than being able to do direct matching on the err.message attribute, you need to do wildcard searching, which is slower, and some providers don’t even support it.\nFurthermore, you lose the ability to group by error type; you can no longer write group by err.message or group by err.type as they all have the same type (composite), or differing messages (especially if the order of the grouped errors is not deterministic.) You also loose out on being able to track how often a specific kind of error is occurring, making alerting on changes in error rates much harder to implement.\nFor these reasons, I would recommend refactoring your code to have a span per operation (or function, whichever provides the granularity you need), such that the main method emits a single span with several child spans, which each can have their own error details, and the parent span can then contain an error, and the overall status of the operation.\nfunc handleMessage(ctx context.Context, m Message) error { ctx, span := tr.StartSpan(ctx, \"handle_message\") defer span.End() oneSuccess := childOperationOne(ctx, m) twoSuccess := childOperationTwo(ctx, m) threeSuccess := childOperationThree(ctx, m) childOperationFour(ctx, m) //optional if oneSuccess \u0026\u0026 twoSuccess \u0026\u0026 threeSuccess { span.SetStatus(codes.Ok) } else { span.SetStatus(codes.Error, \"mandatory operations failed\") } } Multiple related errors A good use case for storing multiple errors is when the operation can emit multiple of the same error before succeeding. For example, an HTTP request retry middleware might emit an error for each attempt it makes but only set the span status to error if there wasn’t a successful call after several tries.\nfunc Retry(ctx context.Context, req http.Request) (http.Response, error) { ctx, span := tr.StartSpan(\"retry\", ctx) defer span.End() maxRetries := 5 span.SetAttributes(attribute.Int(\"retries.max\", maxRetries)) for i := range maxRetries { span.SetAttributes(attribute.Int(\"retries.current\", i)) res, err := client.Do(req) if err == nil { span.SetStatus(codes.Ok, \"\") return res, nil } s.RecordError(err) backOffSleep(i) } retryError := fmt.Errorf(\"failed after %v tries\", maxRetries) span.SetStatus(codes.Error, retryError.Error()) return nil, retryError } Tracing Providers A lot of how you deal with this is still going to come down to which tracing provider/software you use to actually ingest your traces. While OpenTelemetry has a specification of the protocol and fields, it doesn’t specify how a UI has to render that information, so it is possible that you have to adjust your usage to match your provider.\nor example, if there are many child operations, then a span per operation with its own possibility of error would make sense; the parent span could then decide based on the child operations whether the whole operation was successful or not. You could also add attributes such as operation_count, operation_failures, etc.\nNext Steps For the codebase in question, based on what little I know of it, I think adding a few more Spans around the problem areas is the right thing to do; but depending on how many places this occurs, it could be more hassle than its worth.\nI’d stick with the same approach for adding tracing to a codebase: add it where it hurts, as that’s where you’ll see the most value.\n","wordCount":"767","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://andydote.co.uk/2024/07/20/otel-errors/"},"publisher":{"@type":"Organization","name":"Andy Dote","logo":{"@type":"ImageObject","url":"https://andydote.co.uk/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://andydote.co.uk accesskey=h title="Andy Dote (Alt + H)">Andy Dote</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://andydote.co.uk/archive title=Archive><span>Archive</span></a></li><li><a href=https://andydote.co.uk/talks title=Talks><span>Talks</span></a></li><li><a href=https://andydote.co.uk/notes title=Notes><span>Notes</span></a></li><li><a href=https://andydote.co.uk/tags title=Tags><span>Tags</span></a></li><li><a href=https://andydote.co.uk/contact title=Contact><span>Contact</span></a></li><li><a href=https://andydote.co.uk/rss.xml title=RSS><span>RSS</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Multiple errors in an OTEL Span</h1><div class=post-meta><span title='2024-07-20 00:00:00 +0000 UTC'>July 20, 2024</span>&nbsp;·&nbsp;4 min</div></header><div class=post-content><p>A question at work came up recently about how to handle multiple errors in a single span. My reaction is that having multiple errors in a span is a design smell, but I had no particular data or spec to back this up, just a gut feeling. I&rsquo;ve since thought about this more and think that in general, you should only have one error per span, but there are circumstances where multiple indeed makes sense. So, let&rsquo;s dig into them.</p><h2 id=can-i-have-multiple-errors-in-a-span>Can I have multiple errors in a Span?<a hidden class=anchor aria-hidden=true href=#can-i-have-multiple-errors-in-a-span>#</a></h2><p>Yes! An error is stored as an <code>event</code> attached to the <code>span</code>, so calling <code>span.recordError(err)</code> can be called multiple times. However, a span can only have one status: either <code>Unset</code>, <code>Ok</code>, or <code>Error</code>, so while many errors can be recorded, the status of the span can only be set to one value.</p><h2 id=multiple-unrelated-errors>Multiple unrelated errors<a hidden class=anchor aria-hidden=true href=#multiple-unrelated-errors>#</a></h2><p>The problem with wanting to store multiple errors in one trace is that while you can have multiple error events, if you are also using the span&rsquo;s attributes for the error details (i.e. setting <code>err.message</code> and <code>err.details</code> etc.) then whichever was your last error will overwrite previous values.</p><p>One solution offered is to combine all errors into one, and then record that in the attributes. This feels like a bad idea to me due to how you consume the errors in your OTEL service of choice; generally, you filter by attributes without any kind of free text search or, at best, prefix matching.</p><p>This, however, means that you lose a lot of filtering ability. Rather than being able to do direct matching on the <code>err.message</code> attribute, you need to do wildcard searching, which is slower, and some providers don&rsquo;t even support it.</p><p>Furthermore, you lose the ability to group by error type; you can no longer write <code>group by err.message</code> or <code>group by err.type</code> as they all have the same type (<code>composite</code>), or differing messages (especially if the order of the grouped errors is not deterministic.) You also loose out on being able to track how often a specific kind of error is occurring, making alerting on changes in error rates much harder to implement.</p><p>For these reasons, I would recommend refactoring your code to have a span per operation (or function, whichever provides the granularity you need), such that the main method emits a single span with several child spans, which each can have their own error details, and the parent span can then contain an error, and the overall status of the operation.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>handleMessage</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>m</span> <span style=color:#a6e22e>Message</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>span</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>tr</span>.<span style=color:#a6e22e>StartSpan</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#e6db74>&#34;handle_message&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>span</span>.<span style=color:#a6e22e>End</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>oneSuccess</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>childOperationOne</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>m</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>twoSuccess</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>childOperationTwo</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>m</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>threeSuccess</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>childOperationThree</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>m</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>childOperationFour</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>m</span>) <span style=color:#75715e>//optional
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>oneSuccess</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>twoSuccess</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>threeSuccess</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>span</span>.<span style=color:#a6e22e>SetStatus</span>(<span style=color:#a6e22e>codes</span>.<span style=color:#a6e22e>Ok</span>)
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>span</span>.<span style=color:#a6e22e>SetStatus</span>(<span style=color:#a6e22e>codes</span>.<span style=color:#a6e22e>Error</span>, <span style=color:#e6db74>&#34;mandatory operations failed&#34;</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=multiple-related-errors>Multiple related errors<a hidden class=anchor aria-hidden=true href=#multiple-related-errors>#</a></h2><p>A good use case for storing multiple errors is when the operation can emit multiple of the same error before succeeding. For example, an HTTP request retry middleware might emit an error for each attempt it makes but only set the span status to error if there wasn&rsquo;t a successful call after several tries.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Retry</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>req</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) (<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Response</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>span</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>tr</span>.<span style=color:#a6e22e>StartSpan</span>(<span style=color:#e6db74>&#34;retry&#34;</span>, <span style=color:#a6e22e>ctx</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>span</span>.<span style=color:#a6e22e>End</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>maxRetries</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>span</span>.<span style=color:#a6e22e>SetAttributes</span>(<span style=color:#a6e22e>attribute</span>.<span style=color:#a6e22e>Int</span>(<span style=color:#e6db74>&#34;retries.max&#34;</span>, <span style=color:#a6e22e>maxRetries</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>maxRetries</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>span</span>.<span style=color:#a6e22e>SetAttributes</span>(<span style=color:#a6e22e>attribute</span>.<span style=color:#a6e22e>Int</span>(<span style=color:#e6db74>&#34;retries.current&#34;</span>, <span style=color:#a6e22e>i</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>res</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>Do</span>(<span style=color:#a6e22e>req</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>span</span>.<span style=color:#a6e22e>SetStatus</span>(<span style=color:#a6e22e>codes</span>.<span style=color:#a6e22e>Ok</span>, <span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>res</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>RecordError</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>backOffSleep</span>(<span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>retryError</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed after %v tries&#34;</span>, <span style=color:#a6e22e>maxRetries</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>span</span>.<span style=color:#a6e22e>SetStatus</span>(<span style=color:#a6e22e>codes</span>.<span style=color:#a6e22e>Error</span>, <span style=color:#a6e22e>retryError</span>.<span style=color:#a6e22e>Error</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>retryError</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=tracing-providers>Tracing Providers<a hidden class=anchor aria-hidden=true href=#tracing-providers>#</a></h2><p>A lot of how you deal with this is still going to come down to which tracing provider/software you use to actually ingest your traces. While OpenTelemetry has a specification of the protocol and fields, it doesn&rsquo;t specify how a UI has to render that information, so it is possible that you have to adjust your usage to match your provider.</p><p>or example, if there are many child operations, then a span per operation with its own possibility of error would make sense; the parent span could then decide based on the child operations whether the whole operation was successful or not. You could also add attributes such as <code>operation_count</code>, <code>operation_failures</code>, etc.</p><h2 id=next-steps>Next Steps<a hidden class=anchor aria-hidden=true href=#next-steps>#</a></h2><p>For the codebase in question, based on what little I know of it, I think adding a few more Spans around the problem areas is the right thing to do; but depending on how many places this occurs, it could be more hassle than its worth.</p><p>I&rsquo;d stick with the same approach for adding tracing to a codebase: add it where it hurts, as that&rsquo;s where you&rsquo;ll see the most value.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://andydote.co.uk/tags/opentelemetry/>opentelemetry</a></li></ul><nav class=paginav><a class=next href=https://andydote.co.uk/2023/11/15/hot-reload-for-serverside-rendering/><span class=title>Next Page »</span><br><span>Hot Reload for ServerSide Rendering</span></a></nav></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>
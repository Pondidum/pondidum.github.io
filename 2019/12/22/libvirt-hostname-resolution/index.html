<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Libvirt Hostname Resolution | Andy Dote</title><meta name=keywords content="libvirt,vagrant,dns"><meta name=description content="I use Vagrant when testing new machines and experimenting locally with clusters, and since moving (mostly) to Linux, I have been using the LibVirt Plugin to create the virtual machines. Not only is it significantly faster than Hyper-V was on windows, but it also means I don&rsquo;t need to use Oracle products, so it&rsquo;s win-win really.
The only configuration challenge I have had with it is setting up VM hostname resolution, and as I forget how to do it each time, I figured I should write about it."><meta name=author content><link rel=canonical href=https://andydote.co.uk/2019/12/22/libvirt-hostname-resolution/><link crossorigin=anonymous href=/assets/css/stylesheet.min.4ac25d88867f6882d86478d9b478a3d3efa1ed9e18f0bc5e432812301516cb28.css integrity="sha256-SsJdiIZ/aILYZHjZtHij0++h7Z4Y8LxeQygSMBUWyyg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/mermaid.min.725f44bd345b0a2a4043ca952b0863edd789e913cf0813a12bbdfe986fe87079.js integrity="sha256-cl9EvTRbCipAQ8qVKwhj7deJ6RPPCBOhK73+mG/ocHk="></script>
<script defer crossorigin=anonymous src=/js/tabs.min.2d019e9ee3574770ad4ecfd4f5f794739892195cb82a4e6383252b9074ab520c.js integrity="sha256-LQGenuNXR3CtTs/U9feUc5iSGVy4Kk5jgyUrkHSrUgw="></script>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://andydote.co.uk/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://andydote.co.uk/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://andydote.co.uk/favicon-32x32.png><link rel=apple-touch-icon href=https://andydote.co.uk/apple-touch-icon.png><link rel=mask-icon href=https://andydote.co.uk/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Libvirt Hostname Resolution"><meta property="og:description" content="I use Vagrant when testing new machines and experimenting locally with clusters, and since moving (mostly) to Linux, I have been using the LibVirt Plugin to create the virtual machines. Not only is it significantly faster than Hyper-V was on windows, but it also means I don&rsquo;t need to use Oracle products, so it&rsquo;s win-win really.
The only configuration challenge I have had with it is setting up VM hostname resolution, and as I forget how to do it each time, I figured I should write about it."><meta property="og:type" content="article"><meta property="og:url" content="https://andydote.co.uk/2019/12/22/libvirt-hostname-resolution/"><meta property="article:section" content="post"><meta property="article:published_time" content="2019-12-22T00:00:00+00:00"><meta property="article:modified_time" content="2019-12-22T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Libvirt Hostname Resolution"><meta name=twitter:description content="I use Vagrant when testing new machines and experimenting locally with clusters, and since moving (mostly) to Linux, I have been using the LibVirt Plugin to create the virtual machines. Not only is it significantly faster than Hyper-V was on windows, but it also means I don&rsquo;t need to use Oracle products, so it&rsquo;s win-win really.
The only configuration challenge I have had with it is setting up VM hostname resolution, and as I forget how to do it each time, I figured I should write about it."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://andydote.co.uk/post/"},{"@type":"ListItem","position":3,"name":"Libvirt Hostname Resolution","item":"https://andydote.co.uk/2019/12/22/libvirt-hostname-resolution/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Libvirt Hostname Resolution","name":"Libvirt Hostname Resolution","description":"I use Vagrant when testing new machines and experimenting locally with clusters, and since moving (mostly) to Linux, I have been using the LibVirt Plugin to create the virtual machines. Not only is it significantly faster than Hyper-V was on windows, but it also means I don\u0026rsquo;t need to use Oracle products, so it\u0026rsquo;s win-win really.\nThe only configuration challenge I have had with it is setting up VM hostname resolution, and as I forget how to do it each time, I figured I should write about it.","keywords":["libvirt","vagrant","dns"],"articleBody":"I use Vagrant when testing new machines and experimenting locally with clusters, and since moving (mostly) to Linux, I have been using the LibVirt Plugin to create the virtual machines. Not only is it significantly faster than Hyper-V was on windows, but it also means I don’t need to use Oracle products, so it’s win-win really.\nThe only configuration challenge I have had with it is setting up VM hostname resolution, and as I forget how to do it each time, I figured I should write about it.\nSetup First I install the plugin so Vagrant can talk to Libvirt.\nvagrant plugin install vagrant-libvirt I also created a single vagrantfile with two virtual machines defined in it, so that I can check that the machines can resolve each other, as well as the host being able to resolve the guests.\nVagrant.configure(\"2\") do |config| config.vm.box = \"elastic/ubuntu-16.04-x86_64\" config.vm.define \"one\" do |n1| n1.vm.hostname = \"one\" end config.vm.define \"two\" do |n1| n1.vm.hostname = \"two\" end end Once running vagrant up has finished (either with --provider libvirt or setting VAGRANT_DEFAULT_PROVIDER=libvirt), connect to one of the machines, and try to ping the other:\nandy@karhu$ vagrant ssh one vagrant@one$ ping two ping: unknown host two vagrant@one$ exit Now that we can see they can’t resolve each other let’s move on to fixing it.\nCustom Domain The solution is to configure the libvirt network to have a domain name, and then to set the host machine to send requests for that domain to the virtual network.\nFirst, I picked a domain. It doesn’t matter what it is, but I gather using .local will cause problems with other services, so instead, I picked $HOSTNAME.xyz, which is karhu.xyz in this case.\nVagrant-libvirt by default creates a network called vagrant-libvirt, so we can edit it to include the domain name configuration by running the following command:\nvirsh net-edit --network vagrant-libvirt And adding the ` line to the xml which is displayed:\nvagrant-libvirt d265a837-96fd-41fc-b114-d9e076462051 + To make the changes take effect, we need to destroy and re-create the network, so first I destroy the vagrant machines, then destroy and restart the network:\nvagrant destroy -f virsh net-destroy --network vagrant-libvirt virsh net-start --network vagrant-libvirt Finally, we can re-create the machines, and log in to one to check that they can resolve each other:\nandy@karhu$ vagrant up andy@karhu$ vagrant ssh one vagrant@one$ ping two PING two.karhu.xyz (192.168.121.243) 56(84) bytes of data. vagrant@one$ exit You can also check that the host can resolve the machine names when querying the virtual network’s DNS server:\nandy@karhu$ dig @192.168.121.1 +short one \u003e 192.168.121.50 Host DNS Forwarding The host cant talk to the machines by name still, so we need to tweak the host’s DNS, which means fighting with SystemD. Luckily, we only need to forward requests to a DNS server running on port 53 - if it was on another port then replacing systemd-resolved like my post on Consul DNS forwarding would be necessary.\nEdit /etc/systemd/resolved.conf on the host, to add two lines which instruct it to send DNS requests for the domain picked earlier to the DNS server run by libvirt (dnsmasq):\n[Resolve] -#DNS= +DNS=192.168.121.1 #FallbackDNS= -#Domains= +Domains=~karhu.xyz #LLMNR=no #MulticastDNS=no #DNSSEC=no #DNSOverTLS=no #Cache=yes #DNSStubListener=yes #ReadEtcHosts=yes Lastly, restart systemd-resolved for the changes to take effect:\nsystemctl restart systemd-resolved Now we can resolve the guest machines by hostname at the domain we picked earlier:\nandy@karhu$ ping one.karhu.xyz PING one.karhu.xyz (192.168.121.50) 56(84) bytes of data. Done!\n","wordCount":"590","inLanguage":"en","datePublished":"2019-12-22T00:00:00Z","dateModified":"2019-12-22T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://andydote.co.uk/2019/12/22/libvirt-hostname-resolution/"},"publisher":{"@type":"Organization","name":"Andy Dote","logo":{"@type":"ImageObject","url":"https://andydote.co.uk/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://andydote.co.uk accesskey=h title="Andy Dote (Alt + H)">Andy Dote</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://andydote.co.uk/archive title=Archive><span>Archive</span></a></li><li><a href=https://andydote.co.uk/talks title=Talks><span>Talks</span></a></li><li><a href=https://andydote.co.uk/notes title=Notes><span>Notes</span></a></li><li><a href=https://andydote.co.uk/tags title=Tags><span>Tags</span></a></li><li><a href=https://andydote.co.uk/contact title=Contact><span>Contact</span></a></li><li><a href=https://andydote.co.uk/rss.xml title=RSS><span>RSS</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Libvirt Hostname Resolution</h1><div class=post-meta><span title='2019-12-22 00:00:00 +0000 UTC'>December 22, 2019</span>&nbsp;·&nbsp;3 min</div></header><div class=post-content><p>I use <a href=http://vagrantup.com/>Vagrant</a> when testing new machines and experimenting locally with clusters, and since moving (mostly) to Linux, I have been using the <a href=https://github.com/vagrant-libvirt/vagrant-libvirt>LibVirt Plugin</a> to create the virtual machines. Not only is it significantly faster than Hyper-V was on windows, but it also means I don&rsquo;t need to use Oracle products, so it&rsquo;s win-win really.</p><p>The only configuration challenge I have had with it is setting up VM hostname resolution, and as I forget how to do it each time, I figured I should write about it.</p><h2 id=setup>Setup<a hidden class=anchor aria-hidden=true href=#setup>#</a></h2><p>First I install the plugin so Vagrant can talk to Libvirt.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vagrant plugin install vagrant-libvirt
</span></span></code></pre></div><p>I also created a single <code>vagrantfile</code> with two virtual machines defined in it, so that I can check that the machines can resolve each other, as well as the host being able to resolve the guests.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#66d9ef>Vagrant</span><span style=color:#f92672>.</span>configure(<span style=color:#e6db74>&#34;2&#34;</span>) <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>config<span style=color:#f92672>|</span>
</span></span><span style=display:flex><span> config<span style=color:#f92672>.</span>vm<span style=color:#f92672>.</span>box <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;elastic/ubuntu-16.04-x86_64&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> config<span style=color:#f92672>.</span>vm<span style=color:#f92672>.</span>define <span style=color:#e6db74>&#34;one&#34;</span> <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>n1<span style=color:#f92672>|</span>
</span></span><span style=display:flex><span> n1<span style=color:#f92672>.</span>vm<span style=color:#f92672>.</span>hostname <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;one&#34;</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> config<span style=color:#f92672>.</span>vm<span style=color:#f92672>.</span>define <span style=color:#e6db74>&#34;two&#34;</span> <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>n1<span style=color:#f92672>|</span>
</span></span><span style=display:flex><span> n1<span style=color:#f92672>.</span>vm<span style=color:#f92672>.</span>hostname <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;two&#34;</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div><p>Once running <code>vagrant up</code> has finished (either with <code>--provider libvirt</code> or setting <code>VAGRANT_DEFAULT_PROVIDER=libvirt</code>), connect to one of the machines, and try to ping the other:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>andy@karhu$ vagrant ssh one
</span></span><span style=display:flex><span>vagrant@one$ ping two
</span></span><span style=display:flex><span>ping: unknown host two
</span></span><span style=display:flex><span>vagrant@one$ exit
</span></span></code></pre></div><p>Now that we can see they can&rsquo;t resolve each other let&rsquo;s move on to fixing it.</p><h2 id=custom-domain>Custom Domain<a hidden class=anchor aria-hidden=true href=#custom-domain>#</a></h2><p>The solution is to configure the libvirt network to have a domain name, and then to set the host machine to send requests for that domain to the virtual network.</p><p>First, I picked a domain. It doesn&rsquo;t matter what it is, but I gather using <code>.local</code> will cause problems with other services, so instead, I picked <code>$HOSTNAME.xyz</code>, which is <code>karhu.xyz</code> in this case.</p><p>Vagrant-libvirt by default creates a network called <code>vagrant-libvirt</code>, so we can edit it to include the domain name configuration by running the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virsh net-edit --network vagrant-libvirt
</span></span></code></pre></div><p>And adding the `<domain name=karhu.xyz localonly=yes> line to the xml which is displayed:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span>&lt;network ipv6=&#39;yes&#39;&gt;
</span></span><span style=display:flex><span> &lt;name&gt;vagrant-libvirt&lt;/name&gt;
</span></span><span style=display:flex><span> &lt;uuid&gt;d265a837-96fd-41fc-b114-d9e076462051&lt;/uuid&gt;
</span></span><span style=display:flex><span> &lt;forward mode=&#39;nat&#39;/&gt;
</span></span><span style=display:flex><span> &lt;bridge name=&#39;virbr1&#39; stp=&#39;on&#39; delay=&#39;0&#39;/&gt;
</span></span><span style=display:flex><span> &lt;mac address=&#39;52:54:00:a0:ae:fd&#39;/&gt;
</span></span><span style=display:flex><span><span style=color:#a6e22e>+ &lt;domain name=&#39;karhu.xyz&#39; localOnly=&#39;yes&#39;/&gt;
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span> &lt;ip address=&#39;192.168.121.1&#39; netmask=&#39;255.255.255.0&#39;&gt;
</span></span><span style=display:flex><span> &lt;dhcp&gt;
</span></span><span style=display:flex><span> &lt;range start=&#39;192.168.121.1&#39; end=&#39;192.168.121.254&#39;/&gt;
</span></span><span style=display:flex><span> &lt;/dhcp&gt;
</span></span><span style=display:flex><span> &lt;/ip&gt;
</span></span><span style=display:flex><span>&lt;/network&gt;
</span></span></code></pre></div><p>To make the changes take effect, we need to destroy and re-create the network, so first I destroy the vagrant machines, then destroy and restart the network:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vagrant destroy -f
</span></span><span style=display:flex><span>virsh net-destroy --network vagrant-libvirt
</span></span><span style=display:flex><span>virsh net-start --network vagrant-libvirt
</span></span></code></pre></div><p>Finally, we can re-create the machines, and log in to one to check that they can resolve each other:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>andy@karhu$ vagrant up
</span></span><span style=display:flex><span>andy@karhu$ vagrant ssh one
</span></span><span style=display:flex><span>vagrant@one$ ping two
</span></span><span style=display:flex><span>PING two.karhu.xyz <span style=color:#f92672>(</span>192.168.121.243<span style=color:#f92672>)</span> 56<span style=color:#f92672>(</span>84<span style=color:#f92672>)</span> bytes of data.
</span></span><span style=display:flex><span>vagrant@one$ exit
</span></span></code></pre></div><p>You can also check that the host can resolve the machine names when querying the virtual network&rsquo;s DNS server:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>andy@karhu$ dig @192.168.121.1 +short one
</span></span><span style=display:flex><span>&gt; 192.168.121.50
</span></span></code></pre></div><h2 id=host-dns-forwarding>Host DNS Forwarding<a hidden class=anchor aria-hidden=true href=#host-dns-forwarding>#</a></h2><p>The host cant talk to the machines by name still, so we need to tweak the host&rsquo;s DNS, which means fighting with SystemD. Luckily, we only need to forward requests to a DNS server running on port <code>53</code> - if it was on another port then replacing systemd-resolved like <a href=/2019/09/24/consul-ubuntu-dns-revisited/>my post on Consul DNS forwarding</a> would be necessary.</p><p>Edit <code>/etc/systemd/resolved.conf</code> on the host, to add two lines which instruct it to send DNS requests for the domain picked earlier to the DNS server run by libvirt (dnsmasq):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span>[Resolve]
</span></span><span style=display:flex><span><span style=color:#f92672>-#DNS=
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+DNS=192.168.121.1
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>#FallbackDNS=
</span></span><span style=display:flex><span><span style=color:#f92672>-#Domains=
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+Domains=~karhu.xyz
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>#LLMNR=no
</span></span><span style=display:flex><span>#MulticastDNS=no
</span></span><span style=display:flex><span>#DNSSEC=no
</span></span><span style=display:flex><span>#DNSOverTLS=no
</span></span><span style=display:flex><span>#Cache=yes
</span></span><span style=display:flex><span>#DNSStubListener=yes
</span></span><span style=display:flex><span>#ReadEtcHosts=yes
</span></span></code></pre></div><p>Lastly, restart systemd-resolved for the changes to take effect:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl restart systemd-resolved
</span></span></code></pre></div><p>Now we can resolve the guest machines by hostname at the domain we picked earlier:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>andy@karhu$ ping one.karhu.xyz
</span></span><span style=display:flex><span>PING one.karhu.xyz <span style=color:#f92672>(</span>192.168.121.50<span style=color:#f92672>)</span> 56<span style=color:#f92672>(</span>84<span style=color:#f92672>)</span> bytes of data.
</span></span></code></pre></div><p>Done!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://andydote.co.uk/tags/libvirt/>libvirt</a></li><li><a href=https://andydote.co.uk/tags/vagrant/>vagrant</a></li><li><a href=https://andydote.co.uk/tags/dns/>dns</a></li></ul><nav class=paginav><a class=prev href=https://andydote.co.uk/2019/12/30/consul-alpine-dns-revisited/><span class=title>« Prev Page</span><br><span>Consul DNS Fowarding in Alpine, revisited</span></a>
<a class=next href=https://andydote.co.uk/2019/11/21/nomad-good-kubernetes-bad/><span class=title>Next Page »</span><br><span>Nomad Good, Kubernetes Bad</span></a></nav></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>
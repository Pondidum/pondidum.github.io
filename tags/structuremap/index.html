<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>structuremap | Andy Dote</title><meta name=keywords content><meta name=description content><meta name=author content><link rel=canonical href=https://andydote.co.uk/tags/structuremap/><link crossorigin=anonymous href=/assets/css/stylesheet.min.b4e19c453811e60acfec1f00c15ac2be1c53f6ab90187e684358ce7faaf48bab.css integrity="sha256-tOGcRTgR5grP7B8AwVrCvhxT9quQGH5oQ1jOf6r0i6s=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/mermaid.min.725f44bd345b0a2a4043ca952b0863edd789e913cf0813a12bbdfe986fe87079.js integrity="sha256-cl9EvTRbCipAQ8qVKwhj7deJ6RPPCBOhK73+mG/ocHk="></script>
<link rel=icon href=https://andydote.co.uk/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://andydote.co.uk/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://andydote.co.uk/favicon-32x32.png><link rel=apple-touch-icon href=https://andydote.co.uk/apple-touch-icon.png><link rel=mask-icon href=https://andydote.co.uk/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://andydote.co.uk/tags/structuremap/rss.xml><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="structuremap"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://andydote.co.uk/tags/structuremap/"><meta name=twitter:card content="summary"><meta name=twitter:title content="structuremap"><meta name=twitter:description content></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://andydote.co.uk accesskey=h title="Andy Dote (Alt + H)">Andy Dote</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://andydote.co.uk/archive title=Archive><span>Archive</span></a></li><li><a href=https://andydote.co.uk/talks title=Talks><span>Talks</span></a></li><li><a href=https://andydote.co.uk/notes title=Notes><span>Notes</span></a></li><li><a href=https://andydote.co.uk/tags title=Tags><span>Tags</span></a></li><li><a href=https://andydote.co.uk/contact title=Contact><span>Contact</span></a></li><li><a href=https://andydote.co.uk/rss.xml title=RSS><span>RSS</span></a></li></ul></nav></header><main class=main><header class=page-header><h1>structuremap</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2>Composite Decorators with StructureMap</h2></header><div class=entry-content><p>While I was developing my Crispin project, I ended up needing to create a bunch of implementations of a single interface, and then use all those implementations at once (for metrics logging).
The interface looks like so:
public interface IStatisticsWriter { Task WriteCount(string format, params object[] parameters); } And we have a few implementations already:
LoggingStatisticsWriter - writes to an ILogger instance StatsdStatisticsWriter - pushes metrics to StatsD InternalStatisticsWriter - aggregates metrics for exposing via Crispin’s api To make all of these be used together, I created a fourth implementation, called CompositeStatisticsWriter (a name I made up, but apparently matches the Gang of Four definition of a composite!...</p></div><footer class=entry-footer><span title='2017-10-04 00:00:00 +0000 UTC'>October 4, 2017</span>&nbsp;·&nbsp;3 min</footer><a class=entry-link aria-label="post link to Composite Decorators with StructureMap" href=https://andydote.co.uk/2017/10/04/structuremap-composite-decorator/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Testing Containers or Test Behaviour, Not Implementation</h2></header><div class=entry-content><p>The trouble with testing containers is that usually the test ends up very tightly coupled to the implementation.
Let’s see an example. If we start off with an interface and implementation of a “cache”, which in this case is just going to store a single string value.
public interface ICache { string Value { get; set; } } public class Cache { public string Value { get; set; } } We then setup our container (StructureMap in this case) to return the same instance of the cache whenever an ICache is requested:...</p></div><footer class=entry-footer><span title='2017-09-17 00:00:00 +0000 UTC'>September 17, 2017</span>&nbsp;·&nbsp;2 min</footer><a class=entry-link aria-label="post link to Testing Containers or Test Behaviour, Not Implementation" href=https://andydote.co.uk/2017/09/17/testing-containers/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Serilog LogContext with StructureMap and SimpleInjector</h2></header><div class=entry-content><p>This article has been updated after feedback from .Net Junkie (Godfather of SimpleInjector). I now have a working SimpleInjector implementation of this, and am very appreciative of him for taking the time to help me :)
Serilog is one of the main set of libraries I use on a regular basis, and while it is great at logging, it does cause something in our codebase that I am less happy about....</p></div><footer class=entry-footer><span title='2017-07-28 00:00:00 +0000 UTC'>July 28, 2017</span>&nbsp;·&nbsp;4 min</footer><a class=entry-link aria-label="post link to Serilog LogContext with StructureMap and SimpleInjector" href=https://andydote.co.uk/2017/07/28/serilog-context-with-structuremap-and-simpleinjector/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Preventing MicroService Boilerplate</h2></header><div class=entry-content><p>One of the downsides to microservices I have found is that I end up repeating the same blocks of code over and over for each service. Not only that, but the project setup is repetitive, as all the services use the Single Project Service and Console method.
What do we do in every service? Initialise Serilog. Add a Serilog sink to ElasticSearch for Kibana (but only in non-local config.) Hook/Unhook the AppDomain....</p></div><footer class=entry-footer><span title='2016-07-17 00:00:00 +0000 UTC'>July 17, 2016</span>&nbsp;·&nbsp;4 min</footer><a class=entry-link aria-label="post link to Preventing MicroService Boilerplate" href=https://andydote.co.uk/2016/07/17/preventing-microservice-boilerplate/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Using StructureMap Registries for better separation</h2></header><div class=entry-content><p>When it comes to configuring StructureMap, it supports the use of Registries. Registries support everything that the standard configure method does(new Container(c => { /* */});).
There are two main reasons that I use the registries rather then doing all my configuration in the Container’s lambda: separation of concerns (one registry per area of code) and easier testing (which we will go into shortly).
The only down side I can see to using registries is that it can scatter your configuration across your codebase - but if you have ReSharper, doing a ‘Find Implementations’ on Registry will find them all for you, so it really isn’t much of a down side....</p></div><footer class=entry-footer><span title='2014-05-19 00:00:00 +0000 UTC'>May 19, 2014</span>&nbsp;·&nbsp;3 min</footer><a class=entry-link aria-label="post link to Using StructureMap Registries for better separation" href=https://andydote.co.uk/2014/05/19/using-structuremap-registries/></a></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>
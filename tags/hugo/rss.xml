<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>hugo on Andy Dote</title><link>https://andydote.co.uk/tags/hugo/</link><description>Recent content in hugo on Andy Dote</description><generator>Hugo -- gohugo.io</generator><language>en-gb</language><lastBuildDate>Wed, 14 Sep 2022 00:00:00 +0000</lastBuildDate><atom:link href="https://andydote.co.uk/tags/hugo/rss.xml" rel="self" type="application/rss+xml"/><item><title>Embedding ain't easy, but its alright</title><link>https://andydote.co.uk/2022/09/14/embed/</link><pubDate>Wed, 14 Sep 2022 00:00:00 +0000</pubDate><guid>https://andydote.co.uk/2022/09/14/embed/</guid><description>I write a lot of blog posts which contain code snippets. Like most people, I have done this using a fenced codeblock in markdown which is fine for short blocks of code.
The problem occours when I am embedding code from another repository; often there will be tweaks or bug fixes, and keeping the code in the blog post in sync with the code in the other repo is annoying and manual.</description><content:encoded><![CDATA[<p>I write a lot of blog posts which contain code snippets.  Like most people, I have done this using a fenced codeblock in markdown which is fine for short blocks of code.</p>
<p>The problem occours when I am embedding code from another repository; often there will be tweaks or bug fixes, and keeping the code in the blog post in sync with the code in the other repo is annoying and manual.</p>
<p>To make life easier for myself, I wrote a <a href="https://gohugo.io/content-management/shortcodes/">shortcode</a> called <code>git-embed</code>, which at build time will fetch the specified file, and embed either the whole file, or a line range in a highlighted code block.  It supports line ranges (<code>start</code>, <code>finish</code>), and it will use the <code>file</code>&rsquo;s extension as the highlight language, unless you override with <code>lang</code> parameter.</p>
<p>Usage is like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span>{{&lt; <span style="color:#f92672">git-embed</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">user</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Pondidum&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">repo</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;pondidum.github.io&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ref</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;master&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">file</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layouts/shortcodes/git-embed.html&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;go&#34;</span>
</span></span><span style="display:flex;"><span>&gt;}}
</span></span></code></pre></div><p>Which I am using to embed the shorcode&rsquo;s own shortcode:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>{{<span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">user</span> <span style="color:#f92672">:=</span> .<span style="color:#a6e22e">Get</span> <span style="color:#e6db74">&#34;user&#34;</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">repo</span> <span style="color:#f92672">:=</span> .<span style="color:#a6e22e">Get</span> <span style="color:#e6db74">&#34;repo&#34;</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">ref</span> <span style="color:#f92672">:=</span> .<span style="color:#a6e22e">Get</span> <span style="color:#e6db74">&#34;ref&#34;</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">file</span> <span style="color:#f92672">:=</span> .<span style="color:#a6e22e">Get</span> <span style="color:#e6db74">&#34;file&#34;</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{{<span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">source</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">printf</span> <span style="color:#e6db74">&#34;https://github.com/%s/%s/blob/%s/%s&#34;</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">user</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">repo</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">ref</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">file</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">url</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">printf</span> <span style="color:#e6db74">&#34;https://raw.githubusercontent.com/%s/%s/%s/%s&#34;</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">user</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">repo</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">ref</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">file</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">remote</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">resources</span>.<span style="color:#a6e22e">GetRemote</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">url</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{{ <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">all_lines</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">split</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">remote</span>.<span style="color:#a6e22e">Content</span> <span style="color:#e6db74">&#34;\n&#34;</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{{<span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">start</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#f92672">-</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">isset</span> .<span style="color:#a6e22e">Params</span> <span style="color:#e6db74">&#34;start&#34;</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>  {{<span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">start</span> = (.<span style="color:#a6e22e">Get</span> <span style="color:#e6db74">&#34;start&#34;</span>) | <span style="color:#66d9ef">int</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#f92672">-</span> <span style="color:#a6e22e">end</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{{<span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">finish</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">len</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">all_lines</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#f92672">-</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">isset</span> .<span style="color:#a6e22e">Params</span> <span style="color:#e6db74">&#34;finish&#34;</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>  {{ <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">finish</span> = (.<span style="color:#a6e22e">Get</span> <span style="color:#e6db74">&#34;finish&#34;</span>) | <span style="color:#66d9ef">int</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#f92672">-</span> <span style="color:#a6e22e">end</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{{<span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">start</span> = <span style="color:#a6e22e">math</span>.<span style="color:#a6e22e">Max</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">start</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">finish</span> = <span style="color:#a6e22e">math</span>.<span style="color:#a6e22e">Min</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">finish</span> (<span style="color:#a6e22e">len</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">all_lines</span>) <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{{<span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">lines</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">slice</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#f92672">-</span> <span style="color:#66d9ef">range</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">index</span>, <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">num</span> <span style="color:#f92672">:=</span> (<span style="color:#a6e22e">seq</span> (<span style="color:#a6e22e">add</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">start</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) (<span style="color:#a6e22e">add</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">finish</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)) <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>  {{<span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">lines</span> = <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">lines</span> | <span style="color:#a6e22e">append</span> (<span style="color:#a6e22e">index</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">all_lines</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">num</span>) <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#f92672">-</span> <span style="color:#a6e22e">end</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{{<span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">lang</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">TrimPrefix</span> <span style="color:#e6db74">&#34;.&#34;</span> (<span style="color:#a6e22e">path</span>.<span style="color:#a6e22e">Ext</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">file</span>) <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#f92672">-</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">isset</span> .<span style="color:#a6e22e">Params</span> <span style="color:#e6db74">&#34;lang&#34;</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>  {{<span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">lang</span> = .<span style="color:#a6e22e">Get</span> <span style="color:#e6db74">&#34;lang&#34;</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#f92672">-</span> <span style="color:#a6e22e">end</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{{<span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">options</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#f92672">-</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">isset</span> .<span style="color:#a6e22e">Params</span> <span style="color:#e6db74">&#34;options&#34;</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>  {{<span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">options</span> = .<span style="color:#a6e22e">Get</span> <span style="color:#e6db74">&#34;options&#34;</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#f92672">-</span> <span style="color:#a6e22e">end</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{{<span style="color:#f92672">-</span> <span style="color:#a6e22e">highlight</span> ( <span style="color:#a6e22e">delimit</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">lines</span> <span style="color:#e6db74">&#34;\n&#34;</span>) <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">lang</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">options</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#a6e22e">footer</span> <span style="color:#a6e22e">style</span>=<span style="color:#e6db74">&#34;margin: 10px auto;&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#a6e22e">small</span>&gt;&lt;<span style="color:#a6e22e">a</span> <span style="color:#a6e22e">href</span>=<span style="color:#e6db74">&#34;{{- $source -}}&#34;</span>&gt;<span style="color:#a6e22e">Source</span>&lt;<span style="color:#f92672">/</span><span style="color:#a6e22e">a</span>&gt;&lt;<span style="color:#f92672">/</span><span style="color:#a6e22e">small</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">/</span><span style="color:#a6e22e">footer</span>&gt;
</span></span></code></pre></div><footer style="margin: 10px auto;">
  <small><a href="https://github.com/Pondidum/pondidum.github.io/blob/master/layouts/shortcodes/git-embed.html">Source</a></small>
</footer>

<h2 id="future-improvements">Future Improvements</h2>
<p>I&rsquo;d quite like to add a parameter that would allow me to embed a named function, rather than a line range.  I think I&rsquo;d use <a href="https://tree-sitter.github.io/tree-sitter/">Tree-Sitter</a> to do this, but Hugo doesn&rsquo;t seem to have a way to execute an arbitrary command on build, so I&rsquo;d need to make a small API that would do all the work&hellip;  So that can wait for when the itch needs scratching more than this.</p>
]]></content:encoded></item></channel></rss>
<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>vault | Andy Dote</title>
<meta name=keywords content><meta name=description content><meta name=author content><link rel=canonical href=https://andydote.co.uk/tags/vault/><link crossorigin=anonymous href=/assets/css/stylesheet.min.d3aaf8cdcec9a6487824ab95cadf08232ec362e7ba510c6b742973d16ef5b72e.css integrity="sha256-06r4zc7Jpkh4JKuVyt8IIy7DYue6UQxrdClz0W71ty4=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/mermaid.min.c6a36963ab47314b3d95fe85a9385337e1ef8eb1c2194eecb86f178d492ab666.js integrity="sha256-xqNpY6tHMUs9lf6FqThTN+HvjrHCGU7suG8XjUkqtmY="></script><script defer crossorigin=anonymous src=/js/tabs.min.2d019e9ee3574770ad4ecfd4f5f794739892195cb82a4e6383252b9074ab520c.js integrity="sha256-LQGenuNXR3CtTs/U9feUc5iSGVy4Kk5jgyUrkHSrUgw="></script><link rel=icon href=https://andydote.co.uk/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://andydote.co.uk/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://andydote.co.uk/favicon-32x32.png><link rel=apple-touch-icon href=https://andydote.co.uk/apple-touch-icon.png><link rel=mask-icon href=https://andydote.co.uk/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://andydote.co.uk/tags/vault/rss.xml><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="vault"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://andydote.co.uk/tags/vault/"><meta name=twitter:card content="summary"><meta name=twitter:title content="vault"><meta name=twitter:description content></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://andydote.co.uk accesskey=h title="Andy Dote (Alt + H)">Andy Dote</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://andydote.co.uk/archive title=Archive><span>Archive</span></a></li><li><a href=https://andydote.co.uk/talks title=Talks><span>Talks</span></a></li><li><a href=https://andydote.co.uk/notes title=Notes><span>Notes</span></a></li><li><a href=https://andydote.co.uk/tags title=Tags><span>Tags</span></a></li><li><a href=https://andydote.co.uk/contact title=Contact><span>Contact</span></a></li><li><a href=https://andydote.co.uk/rss.xml title=RSS><span>RSS</span></a></li></ul></nav></header><main class=main><header class=page-header><h1>vault</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2>Adding Observability to Vault</h2></header><div class=entry-content><p>One of the things I like to do when setting up a Vault cluster is to visualise all the operations Vault is performing, which helps see usage patterns changing, whether there are lots of failed requests coming in, and what endpoints are receiving the most traffic.
While Vault has a lot of data available in Prometheus telemetry, the kind of information I am after is best taken from the Audit backend....</p></div><footer class=entry-footer>&lt;span title='2021-05-27 00:00:00 +0000 UTC'>May 27, 2021&lt;/span>&amp;nbsp;·&amp;nbsp;7 min</footer><a class=entry-link aria-label="post link to Adding Observability to Vault" href=https://andydote.co.uk/2021/05/27/vault-observe/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Creating a Vault instance with a TLS Consul Cluster</h2></header><div class=entry-content><p>So we want to set up a Vault instance, and have it’s storage be a TLS based Consul cluster. The problem is that the Consul cluster needs Vault to create the certificates for TLS, which is quite the catch-22. Luckily for us, quite easy to solve:
Start a temporary Vault instance as an intermediate ca Launch Consul cluster, using Vault to generate certificates Destroy temporary Vault instance Start a permanent Vault instance, with Consul as the store Reprovision the Consul cluster with certificates from the new Vault instance There is a repository on Github with all the scripts used, and a few more details on some options....</p></div><footer class=entry-footer>&lt;span title='2019-10-06 00:00:00 +0000 UTC'>October 6, 2019&lt;/span>&amp;nbsp;·&amp;nbsp;3 min</footer><a class=entry-link aria-label="post link to Creating a Vault instance with a TLS Consul Cluster" href=https://andydote.co.uk/2019/10/06/vault-consul-bootstrap/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Creating a TLS enabled Consul cluster</h2></header><div class=entry-content><p>This post is going to go through how to set up a Consul cluster to communicate over TLS. I will be using Vagrant to create three machines locally, which will form my cluster, and in the provisioning step will use Vault to generate the certificates needed.
How to securely communicate with Vault to get the TLS certificates is out of scope for this post.
Host Configuration Unless you already have Vault running somewhere on your network, or have another mechanism to generate TLS certificates for each machine, you’ll need to start and configure Vault on the Host machine....</p></div><footer class=entry-footer>&lt;span title='2019-09-14 00:00:00 +0000 UTC'>September 14, 2019&lt;/span>&amp;nbsp;·&amp;nbsp;6 min</footer><a class=entry-link aria-label="post link to Creating a TLS enabled Consul cluster" href=https://andydote.co.uk/2019/09/14/consul-tls-cluster/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Using Vault as a Development CA</h2></header><div class=entry-content><p>Often when developing or testing some code, I need (or want) to use SSL, and one of the easiest ways to do that is to use Vault. However, it gets pretty annoying having to generate a new CA for each project, and import the CA cert into windows (less painful in Linux, but still annoying), especially as I forget which cert is in use, and accidentally clean up the wrong ones....</p></div><footer class=entry-footer>&lt;span title='2019-08-25 00:00:00 +0000 UTC'>August 25, 2019&lt;/span>&amp;nbsp;·&amp;nbsp;4 min</footer><a class=entry-link aria-label="post link to Using Vault as a Development CA" href=https://andydote.co.uk/2019/08/25/vault-development-ca/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Running a Secure RabbitMQ Cluster in Nomad</h2></header><div class=entry-content><p>Last time I wrote about running a RabbitMQ cluster in Nomad, one of the main pieces of feedback I received was about the (lack) of security of the setup, so I decided to revisit this, and write about how to launch as secure RabbitMQ node in Nomad.
The things I want to cover are:
Username and Password for the management UI Secure value for the Erlang Cookie SSL for Management and AMQP As usual, the demo repository with all the code is available if you’d rather just jump into that....</p></div><footer class=entry-footer>&lt;span title='2019-04-06 00:00:00 +0000 UTC'>April 6, 2019&lt;/span>&amp;nbsp;·&amp;nbsp;9 min</footer><a class=entry-link aria-label="post link to Running a Secure RabbitMQ Cluster in Nomad" href=https://andydote.co.uk/2019/04/06/nomad-rabbitmq-secure/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Locking Vault Down with Policies</h2></header><div class=entry-content><p>The final part of my Vault miniseries focuses on permissioning, which is provided by Vault’s Policies.
As everything in Vault is represented as a path, the policies DSL (Domain Specific Language) just needs to apply permissions to paths to lock things down. For example, to allow all operations on the cubbyhole secret engine, we would define this policy:
path "cubbyhole/*" { capabilities = ["create", "read", "update", "delete", "list"] } Vault comes with a default policy which allows token operations (such as looking up its own token info, releasing and renewing tokens), and cubbyhole access....</p></div><footer class=entry-footer>&lt;span title='2018-06-23 00:00:00 +0000 UTC'>June 23, 2018&lt;/span>&amp;nbsp;·&amp;nbsp;4 min</footer><a class=entry-link aria-label="post link to Locking Vault Down with Policies" href=https://andydote.co.uk/2018/06/23/vault-locking-it-down-with-policies/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Secure Communication with Vault</h2></header><div class=entry-content><p>I think Vault by Hashicorp is a great product - I particularly love how you can do dynamic secret generation (e.g for database connections). But how do you validate that the application requesting the secret is allowed to perform that action? How do you know it’s not someone or something impersonating your application?
While musing this at an airport the other day, my colleague Patrik sent me a link to a StackOverflow post about this very question...</p></div><footer class=entry-footer>&lt;span title='2018-06-22 00:00:00 +0000 UTC'>June 22, 2018&lt;/span>&amp;nbsp;·&amp;nbsp;5 min</footer><a class=entry-link aria-label="post link to Secure Communication with Vault" href=https://andydote.co.uk/2018/06/22/vault-secure-communication/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Managing Postgres Connection Strings with Vault</h2></header><div class=entry-content><p>One of the points I made in my recent NDC talk on 12 Factor microservices, was that you shouldn’t be storing sensitive data, such as API keys, usernames, passwords etc. in the environment variables.
Don’t Store Sensitive Data in the Environment
My reasoning is that when you were accessing Environment Variables in Heroku’s platform, you were actually accessing some (probably) secure key-value store, rather than actual environment variables.
While you can use something like Consul’s key-value store for this, it’s not much better as it still stores all the values in plaintext, and has no auditing or logging....</p></div><footer class=entry-footer>&lt;span title='2018-06-17 00:00:00 +0000 UTC'>June 17, 2018&lt;/span>&amp;nbsp;·&amp;nbsp;6 min</footer><a class=entry-link aria-label="post link to Managing Postgres Connection Strings with Vault" href=https://andydote.co.uk/2018/06/17/secret-management-vault-postgres-connection/></a></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>
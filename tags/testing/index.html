<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>testing | Andy Dote</title><meta name=keywords content><meta name=description content><meta name=author content><link rel=canonical href=https://andydote.co.uk/tags/testing/><link crossorigin=anonymous href=/assets/css/stylesheet.min.ea821116adbd94ff8c04bf7745204429750a1079f16951db0415b837fc273249.css integrity="sha256-6oIRFq29lP+MBL93RSBEKXUKEHnxaVHbBBW4N/wnMkk=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/mermaid.min.725f44bd345b0a2a4043ca952b0863edd789e913cf0813a12bbdfe986fe87079.js integrity="sha256-cl9EvTRbCipAQ8qVKwhj7deJ6RPPCBOhK73+mG/ocHk="></script>
<link rel=icon href=https://andydote.co.uk/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://andydote.co.uk/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://andydote.co.uk/favicon-32x32.png><link rel=apple-touch-icon href=https://andydote.co.uk/apple-touch-icon.png><link rel=mask-icon href=https://andydote.co.uk/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://andydote.co.uk/tags/testing/rss.xml><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="testing"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://andydote.co.uk/tags/testing/"><meta name=twitter:card content="summary"><meta name=twitter:title content="testing"><meta name=twitter:description content></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://andydote.co.uk accesskey=h title="Andy Dote (Alt + H)">Andy Dote</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://andydote.co.uk/archive title=Archive><span>Archive</span></a></li><li><a href=https://andydote.co.uk/talks title=Talks><span>Talks</span></a></li><li><a href=https://andydote.co.uk/notes title=Notes><span>Notes</span></a></li><li><a href=https://andydote.co.uk/tags title=Tags><span>Tags</span></a></li><li><a href=https://andydote.co.uk/contact title=Contact><span>Contact</span></a></li><li><a href=https://andydote.co.uk/rss.xml title=RSS><span>RSS</span></a></li></ul></nav></header><main class=main><header class=page-header><h1>testing</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2>Testing Immutable Infrastructure</h2></header><div class=entry-content><p>In my previous post, I glossed over one of the most important and useful parts of Immutable Infrastructure: Testability. There are many kinds of tests we can write for our infrastructure, but they should all be focused on the machine/service and maybe it’s nearest dependencies, not the entire system.
While this post focuses on testing a full machine (both locally in a VM, and remotely as an Amazon EC2 instance), it is also possible to do most of the same kind of tests against a Docker container....</p></div><footer class=entry-footer><span title='2019-01-01 00:00:00 +0000 UTC'>January 1, 2019</span>&nbsp;·&nbsp;17 min</footer><a class=entry-link aria-label="post link to Testing Immutable Infrastructure" href=https://andydote.co.uk/2019/01/01/immutable-infra/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Branching and Red Builds</h2></header><div class=entry-content><p>So this is a bit of a rant…but hopefully with some solutions and workarounds too. So let’s kick things off with a nice statement:
I hate broken builds.
So everyone basically agrees on this point I think. The problem is that I mean all builds, including ones on shared feature branches.
Currently, I work on a number of projects which uses small(ish) feature branches. The way this works is that the team agrees on a new feature to work on creates a branch, and then each developer works on tasks, committing on their own branches, and Pull-Requesting to the feature branch....</p></div><footer class=entry-footer><span title='2018-08-10 00:00:00 +0000 UTC'>August 10, 2018</span>&nbsp;·&nbsp;3 min</footer><a class=entry-link aria-label="post link to Branching and Red Builds" href=https://andydote.co.uk/2018/08/10/red-builds/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Test Expressiveness</h2></header><div class=entry-content><p>We have a test suite at work which tests a retry decorator class works as expected. One of the tests checks that when the inner implementation throws an exception, it will log the number of times it has failed:
[Test] public async Task ShouldLogRetries() { var mockClient = Substitute.For&lt;IContractProvider>(); var logger = Subsitute.For&lt;ILogger>(); var sut = new RetryDecorator(mockClient, logger, maxRetries: 3); mockClient .GetContractPdf(Arg.Any&lt;string>()) .Throws(new ContractDownloadException()); try { await sut.GetContractPdf("foo"); } catch (Exception e){} logger....</p></div><footer class=entry-footer><span title='2018-02-26 00:00:00 +0000 UTC'>February 26, 2018</span>&nbsp;·&nbsp;2 min</footer><a class=entry-link aria-label="post link to Test Expressiveness" href=https://andydote.co.uk/2018/02/26/test-expressiveness/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Vagrant in the world of Docker</h2></header><div class=entry-content><p>I gave a little talk at work recently on my use of Vagrant, what it is, and why it is still useful in a world full of Docker containers.
So, What is Vagrant? Vagrant is a product by Hashicorp, and is for scripting the creation of (temporary) virtual machines. It’s pretty fast to create a virtual machine with too, as it creates them from a base image (known as a “box”....</p></div><footer class=entry-footer><span title='2017-10-22 00:00:00 +0000 UTC'>October 22, 2017</span>&nbsp;·&nbsp;4 min</footer><a class=entry-link aria-label="post link to Vagrant in the world of Docker" href=https://andydote.co.uk/2017/10/22/vagrant-in-a-world-of-docker/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Testing RabbitMQ Concurrency in MassTransit</h2></header><div class=entry-content><p>We have a service which consumes messages from a RabbitMQ queue - for each message, it makes a few http calls, collates the results, does a little processing, and then pushes the results to a 3rd party api. One of the main benefits to having this behind a queue is our usage pattern - the queue usually only has a few messages in it per second, but periodically it will get a million or so messages within 30 minutes (so from ~5 messages/second to ~560 messages/second....</p></div><footer class=entry-footer><span title='2017-10-11 00:00:00 +0000 UTC'>October 11, 2017</span>&nbsp;·&nbsp;4 min</footer><a class=entry-link aria-label="post link to Testing RabbitMQ Concurrency in MassTransit" href=https://andydote.co.uk/2017/10/11/masstransit-rabbitmq-concurrency-testing/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Integration Testing with Dotnet Core, Docker and RabbitMQ</h2></header><div class=entry-content><p>When building libraries, not only is it a good idea to have a large suite of Unit Tests, but also a suite of Integration Tests.
For one of my libraries (RabbitHarness) I have a set of tests which check it behaves as expected against a real instance of RabbitMQ. Ideally these tests will always be run, but sometimes RabbitMQ just isn’t available such as when running on AppVeyor builds, or if I haven’t started my local RabbitMQ Docker container....</p></div><footer class=entry-footer><span title='2017-10-02 00:00:00 +0000 UTC'>October 2, 2017</span>&nbsp;·&nbsp;4 min</footer><a class=entry-link aria-label="post link to Integration Testing with Dotnet Core, Docker and RabbitMQ" href=https://andydote.co.uk/2017/10/02/dotnet-core-docker-integration-tests/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Testing Containers or Test Behaviour, Not Implementation</h2></header><div class=entry-content><p>The trouble with testing containers is that usually the test ends up very tightly coupled to the implementation.
Let’s see an example. If we start off with an interface and implementation of a “cache”, which in this case is just going to store a single string value.
public interface ICache { string Value { get; set; } } public class Cache { public string Value { get; set; } } We then setup our container (StructureMap in this case) to return the same instance of the cache whenever an ICache is requested:...</p></div><footer class=entry-footer><span title='2017-09-17 00:00:00 +0000 UTC'>September 17, 2017</span>&nbsp;·&nbsp;2 min</footer><a class=entry-link aria-label="post link to Testing Containers or Test Behaviour, Not Implementation" href=https://andydote.co.uk/2017/09/17/testing-containers/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Unit Tests & Scratchpads</h2></header><div class=entry-content><p>Often when developing something, I have the need to check how a function or library works. For example, I always have to check for this question:
Does Directory.ListFiles(".\\temp\\") return a list of filenames, a list of relative filepaths, or a list of rooted filepaths?
It returns relative filepaths by the way:
Directory.ListFiles(".\\temp\\"); [ ".\temp\NuCrunch.Tests.csproj", ".\temp\packages.config", ".\temp\Scratchpad.cs" ] Now that there is a C# Interactive window in Visual Studio, you can use that to test the output....</p></div><footer class=entry-footer><span title='2017-01-21 00:00:00 +0000 UTC'>January 21, 2017</span>&nbsp;·&nbsp;2 min</footer><a class=entry-link aria-label="post link to Unit Tests & Scratchpads" href=https://andydote.co.uk/2017/01/21/unit-tests-and-scratchpads/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Shouldly: Why would you assert any other way?</h2></header><div class=entry-content><p>I like to make my development life as easy as possible - and removing small irritations is a great way of doing this. Having used Shouldly in anger for a long time, I have to say I feel a little hamstrung when going back to just using NUnit’s assertions.
I have been known on a couple of projects which use only NUnit assertions, when trying to solve a test failure with array differences, to install Shouldly, fix the test, then remove Shouldly again!...</p></div><footer class=entry-footer><span title='2016-10-09 00:00:00 +0000 UTC'>October 9, 2016</span>&nbsp;·&nbsp;4 min</footer><a class=entry-link aria-label="post link to Shouldly: Why would you assert any other way?" href=https://andydote.co.uk/2016/10/09/assertion-style/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Using StructureMap Registries for better separation</h2></header><div class=entry-content><p>When it comes to configuring StructureMap, it supports the use of Registries. Registries support everything that the standard configure method does(new Container(c => { /* */});).
There are two main reasons that I use the registries rather then doing all my configuration in the Container’s lambda: separation of concerns (one registry per area of code) and easier testing (which we will go into shortly).
The only down side I can see to using registries is that it can scatter your configuration across your codebase - but if you have ReSharper, doing a ‘Find Implementations’ on Registry will find them all for you, so it really isn’t much of a down side....</p></div><footer class=entry-footer><span title='2014-05-19 00:00:00 +0000 UTC'>May 19, 2014</span>&nbsp;·&nbsp;3 min</footer><a class=entry-link aria-label="post link to Using StructureMap Registries for better separation" href=https://andydote.co.uk/2014/05/19/using-structuremap-registries/></a></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>